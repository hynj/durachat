const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/D8HI6Bhs.js","../chunks/D0RciOE6.js","../chunks/Dp1pzeXC.js","../chunks/B6bYGZD0.js"])))=>i.map(i=>d[i]);
var bt=Object.defineProperty;var kt=(u,n,r)=>n in u?bt(u,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[n]=r;var ke=(u,n,r)=>kt(u,typeof n!="symbol"?n+"":n,r);import{c as le,a as c,f as _,s as ge,t as Ee,d as je,v as Te,w as Pt}from"../chunks/BDdIJgRh.js";import{aR as Ct,f as W,p as _e,d as f,Q as $t,r as g,b as xe,s as S,a as Pe,o as Ue,c as o,g as e,K as Re,e as m,t as ve,S as fe,n as ie,aS as De,aT as Mt,aU as St}from"../chunks/Bcdcg6QJ.js";import{i as B}from"../chunks/CGJFYSJu.js";import{_ as Qe}from"../chunks/Dp1pzeXC.js";import{l as Ce,s as $e,p as U,r as Tt,d as Be,c as ye,a as It,b as At}from"../chunks/HP_sVpL7.js";import{p as Nt}from"../chunks/DV4FHoSA.js";import{g as Et}from"../chunks/Cy-hLvyf.js";import{a as Ke,u as Ze,b as Rt,g as Ft,d as Xe,v as Wt,e as Lt,f as zt}from"../chunks/D8HI6Bhs.js";import{I as Dt,V as Kt,M as Ot,F as jt,a as Ut,u as Bt,A as Gt,C as Ht}from"../chunks/k013B_hz.js";import{I as dt,C as ct,t as Oe,a as Ye,b as Vt}from"../chunks/af7Bwi91.js";import{I as Me,s as Se,a as Jt,c as qt,d as Qt,B as ue,e as Fe,h as Zt,i as Xt,j as Yt}from"../chunks/BNH1bgBz.js";import{B as et,a as en,d as ut,e as vt,C as tn,b as nn,c as on,K as tt}from"../chunks/1GFsE5rG.js";import{c as gt}from"../chunks/B6bYGZD0.js";import{L as nt}from"../chunks/BQlalapJ.js";import"../chunks/DU4ySZei.js";import{S as rn,X as ot,s as rt}from"../chunks/CavqSQw7.js";const sn=Ct;function an(u,n){const r=Ce(n,["children","$$slots","$$events","$$legacy"]),l=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18"}]];Me(u,$e({name:"brain"},()=>r,{get iconNode(){return l},children:(a,i)=>{var s=le(),p=W(s);Se(p,n,"default",{}),c(a,s)},$$slots:{default:!0}}))}function Ge(u,n){const r=Ce(n,["children","$$slots","$$events","$$legacy"]),l=[["path",{d:"m6 9 6 6 6-6"}]];Me(u,$e({name:"chevron-down"},()=>r,{get iconNode(){return l},children:(a,i)=>{var s=le(),p=W(s);Se(p,n,"default",{}),c(a,s)},$$slots:{default:!0}}))}function st(u,n){const r=Ce(n,["children","$$slots","$$events","$$legacy"]),l=[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"}],["path",{d:"M9 18c-4.51 2-5-2-7-2"}]];Me(u,$e({name:"github"},()=>r,{get iconNode(){return l},children:(a,i)=>{var s=le(),p=W(s);Se(p,n,"default",{}),c(a,s)},$$slots:{default:!0}}))}function at(u,n){const r=Ce(n,["children","$$slots","$$events","$$legacy"]),l=[["path",{d:"m10 17 5-5-5-5"}],["path",{d:"M15 12H3"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"}]];Me(u,$e({name:"log-in"},()=>r,{get iconNode(){return l},children:(a,i)=>{var s=le(),p=W(s);Se(p,n,"default",{}),c(a,s)},$$slots:{default:!0}}))}function it(u,n){const r=Ce(n,["children","$$slots","$$events","$$legacy"]),l=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"}]];Me(u,$e({name:"message-circle"},()=>r,{get iconNode(){return l},children:(a,i)=>{var s=le(),p=W(s);Se(p,n,"default",{}),c(a,s)},$$slots:{default:!0}}))}function ln(u,n){const r=Ce(n,["children","$$slots","$$events","$$legacy"]),l=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551"}]];Me(u,$e({name:"paperclip"},()=>r,{get iconNode(){return l},children:(a,i)=>{var s=le(),p=W(s);Se(p,n,"default",{}),c(a,s)},$$slots:{default:!0}}))}function dn(u,n){const r=Ce(n,["children","$$slots","$$events","$$legacy"]),l=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"}],["path",{d:"m21.854 2.147-10.94 10.939"}]];Me(u,$e({name:"send"},()=>r,{get iconNode(){return l},children:(a,i)=>{var s=le(),p=W(s);Se(p,n,"default",{}),c(a,s)},$$slots:{default:!0}}))}function lt(u,n){const r=Ce(n,["children","$$slots","$$events","$$legacy"]),l=[["path",{d:"M12 3v12"}],["path",{d:"m17 8-5-5-5 5"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}]];Me(u,$e({name:"upload"},()=>r,{get iconNode(){return l},children:(a,i)=>{var s=le(),p=W(s);Se(p,n,"default",{}),c(a,s)},$$slots:{default:!0}}))}class cn{constructor(n="ws://localhost:5787"){ke(this,"ws",null);ke(this,"url");ke(this,"handlers",new Map);ke(this,"reconnectAttempts",0);ke(this,"maxReconnectAttempts",5);ke(this,"reconnectDelay",1e3);ke(this,"conversationId",null);{const r=new URL("/test/ws",location.href);r.protocol="wss",this.url=r.toString()}}connect(n){return new Promise((r,l)=>{try{const a=new URL(this.url);n&&(a.searchParams.set("conversationId",n),this.conversationId=n),a.searchParams.set("sessionId",`session-${Date.now()}`),this.ws=new WebSocket(a.toString()),this.ws.onopen=()=>{this.reconnectAttempts=0,this.emit("connected",{type:"connected"}),r()},this.ws.onmessage=i=>{try{const s=JSON.parse(i.data);this.emit(s.type,s),s.type==="conversation_created"&&s.conversationId&&(this.conversationId=s.conversationId)}catch(s){console.error("Failed to parse WebSocket message:",s)}},this.ws.onerror=i=>{console.error("WebSocket error:",i),this.emit("error",{type:"error",message:"Connection error"}),l(i)},this.ws.onclose=()=>{this.emit("disconnected",{type:"disconnected"}),this.handleReconnect()}}catch(a){l(a)}})}handleReconnect(){if(this.reconnectAttempts<this.maxReconnectAttempts){this.reconnectAttempts++;const n=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);setTimeout(()=>{console.log(`Reconnecting... attempt ${this.reconnectAttempts}`),this.connect(this.conversationId||void 0)},n)}}startChat(n,r,l,a,i,s){var p,I;if(console.log("ðŸš€ ChatClient.startChat called with:",{prompt:n,conversationId:r,messageId:l,provider:a,model:i,reasoningEffort:s}),console.log("ðŸ”— WebSocket state:",(p=this.ws)==null?void 0:p.readyState,"Open?",((I=this.ws)==null?void 0:I.readyState)===WebSocket.OPEN),this.ws&&this.ws.readyState===WebSocket.OPEN){const T={type:"start_chat",prompt:n,conversationId:r||this.conversationId,messageId:l,provider:a,model:i,reasoningEffort:s};console.log("ðŸ“¤ Sending WebSocket message:",T),this.ws.send(JSON.stringify(T))}else throw console.error("âŒ WebSocket not connected - cannot send message"),new Error("WebSocket not connected")}switchConversation(n){if(console.log("ðŸ”„ ChatClient.switchConversation called with:",n),this.ws&&this.ws.readyState===WebSocket.OPEN){const r={type:"switch_conversation",conversationId:n};console.log("ðŸ“¤ Sending switch_conversation message:",r),this.ws.send(JSON.stringify(r))}else throw console.error("âŒ WebSocket not connected - cannot switch conversation"),new Error("WebSocket not connected")}deleteConversation(n){if(console.log("ðŸ—‘ï¸ ChatClient.deleteConversation called with:",n),this.ws&&this.ws.readyState===WebSocket.OPEN){const r={type:"delete_conversation",conversationId:n};console.log("ðŸ“¤ Sending delete_conversation message:",r),this.ws.send(JSON.stringify(r))}else throw console.error("âŒ WebSocket not connected - cannot delete conversation"),new Error("WebSocket not connected")}ping(){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"ping"}))}on(n,r){this.handlers.has(n)||this.handlers.set(n,[]),this.handlers.get(n).push(r)}off(n,r){const l=this.handlers.get(n);if(l){const a=l.indexOf(r);a>-1&&l.splice(a,1)}}emit(n,r){const l=this.handlers.get(n);l&&l.forEach(a=>a(r))}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}getConversationId(){return this.conversationId}isConnected(){return this.ws?this.ws.readyState===WebSocket.OPEN:!1}}var un=_("<div><!></div>");function vn(u,n){_e(n,!0);let r=U(n,"ref",15,null),l=Tt(n,["$$slots","$$events","$$legacy","ref","class","children"]);var a=un();Jt(a,s=>({"data-slot":"card-footer",class:s,...l}),[()=>qt("flex items-center px-6 [.border-t]:pt-6",n.class)]);var i=f(a);Qt(i,()=>n.children??$t),g(a),Be(a,s=>r(s),()=>r()),c(u,a),xe()}const ft={google:{name:"google",displayName:"Google Gemini",defaultModel:"gemini-2.5-flash-preview-05-20",supportedAttachmentTypes:["image/png","image/jpeg","image/gif","image/webp","application/pdf","text/plain","text/html","audio/wav","audio/mp3","audio/mpeg","video/mp4","video/mpeg","video/quicktime"],models:[{id:"gemini-2.5-pro-preview-06-05",displayName:"Gemini 2.5 Pro",description:"Most capable model for complex reasoning tasks",contextWindow:1e6,inputPricing:"$1.25 / 1M tokens (<=200k), $2.50 / 1M tokens (>200k)",outputPricing:"$10.00 / 1M tokens (<=200k), $15.00 / 1M tokens (>200k)",promptTokenCostPer1K:.125,completionTokenCostPer1K:1,supportsThinking:!0},{id:"gemini-2.5-flash-preview-05-20",displayName:"Gemini 2.5 Flash (Thinking)",description:"Fast model with advanced reasoning capabilities",contextWindow:1e6,inputPricing:"$0.30 / 1M tokens (text/image/video), $1.00 / 1M tokens (audio)",outputPricing:"$2.50 / 1M tokens",promptTokenCostPer1K:.03,completionTokenCostPer1K:.25,supportsThinking:!0},{id:"gemini-2.5-flash-preview-05-20-non-thinking",displayName:"Gemini 2.5 Flash (Standard)",description:"Fast and cost-effective model for most tasks",contextWindow:1e6,inputPricing:"$0.30 / 1M tokens (text/image/video), $1.00 / 1M tokens (audio)",outputPricing:"$2.50 / 1M tokens",promptTokenCostPer1K:.03,completionTokenCostPer1K:.25,supportsThinking:!1},{id:"gemini-2.5-flash-lite-preview-06-17",displayName:"Gemini 2.5 Flash Lite",description:"Lower cost model for large scale processing and high volume tasks",contextWindow:1e6,inputPricing:"$0.10 / 1M tokens",outputPricing:"$0.40 / 1M tokens",promptTokenCostPer1K:.01,completionTokenCostPer1K:.04,supportsThinking:!0}]},openai:{name:"openai",displayName:"OpenAI GPT",defaultModel:"gpt-4o",supportedAttachmentTypes:["image/png","image/jpeg","image/gif","image/webp"],models:[{id:"gpt-4o",displayName:"GPT-4o",description:"Most advanced multimodal model",contextWindow:128e3,supportsThinking:!1},{id:"gpt-4o-mini",displayName:"GPT-4o Mini",description:"Affordable and intelligent small model",contextWindow:128e3,supportsThinking:!1},{id:"gpt-4.1",displayName:"GPT-4.1",description:"Smartest model for complex tasks",contextWindow:128e3,inputPricing:"$2.00 / 1M tokens",outputPricing:"$8.00 / 1M tokens",promptTokenCostPer1K:.2,completionTokenCostPer1K:.8,supportsThinking:!1},{id:"gpt-4.1-mini",displayName:"GPT-4.1 Mini",description:"Affordable model balancing speed and intelligence",contextWindow:128e3,inputPricing:"$0.40 / 1M tokens",outputPricing:"$1.60 / 1M tokens",promptTokenCostPer1K:.04,completionTokenCostPer1K:.16,supportsThinking:!1},{id:"gpt-4.1-nano",displayName:"GPT-4.1 Nano",description:"Fastest, most cost-effective model for low-latency tasks",contextWindow:128e3,inputPricing:"$0.100 / 1M tokens",outputPricing:"$0.400 / 1M tokens",promptTokenCostPer1K:.01,completionTokenCostPer1K:.04,supportsThinking:!1},{id:"o3-2025-04-16",displayName:"OpenAI o3",description:"Most powerful reasoning model with leading performance on coding, math, science, and vision",contextWindow:128e3,inputPricing:"$2.00 / 1M tokens",outputPricing:"$8.00 / 1M tokens",promptTokenCostPer1K:.2,completionTokenCostPer1K:.8,supportsThinking:!0,supportsReasoningEffort:!0,reasoningEffortLevels:["low","medium","high"],defaultReasoningEffort:"medium"},{id:"o4-mini-2025-04-16",displayName:"OpenAI o4-mini",description:"Faster, cost-efficient reasoning model delivering strong performance on math, coding and vision",contextWindow:128e3,inputPricing:"$1.100 / 1M tokens",outputPricing:"$4.400 / 1M tokens",promptTokenCostPer1K:.11,completionTokenCostPer1K:.44,supportsThinking:!0,supportsReasoningEffort:!0,reasoningEffortLevels:["low","medium","high"],defaultReasoningEffort:"medium"}]},anthropic:{name:"anthropic",displayName:"Anthropic Claude",defaultModel:"claude-sonnet-4-20250514",supportedAttachmentTypes:["image/png","image/jpeg","image/gif","image/webp","application/pdf","text/plain","text/html"],models:[{id:"claude-sonnet-4-20250514",displayName:"Claude Sonnet 4",description:"Latest generation Sonnet model",contextWindow:2e5,inputPricing:"$3.00 / 1M tokens",outputPricing:"$15.00 / 1M tokens",promptTokenCostPer1K:.3,completionTokenCostPer1K:1.5,supportsThinking:!0},{id:"claude-opus-4-20250514",displayName:"Claude Opus 4",description:"Most powerful Claude model for complex tasks",contextWindow:2e5,inputPricing:"$15.00 / 1M tokens",outputPricing:"$75.00 / 1M tokens",promptTokenCostPer1K:1.5,completionTokenCostPer1K:7.5,supportsThinking:!0},{id:"claude-3-5-sonnet-20241022",displayName:"Claude 3.5 Sonnet",description:"Balanced model for most tasks",contextWindow:2e5,inputPricing:"$3.00 / 1M tokens",outputPricing:"$15.00 / 1M tokens",promptTokenCostPer1K:.3,completionTokenCostPer1K:1.5,supportsThinking:!1},{id:"claude-3-5-haiku-20241022",displayName:"Claude 3.5 Haiku",description:"Fast and efficient model",contextWindow:2e5,inputPricing:"$0.80 / MTok",outputPricing:"$4.00 / MTok",promptTokenCostPer1K:.08,completionTokenCostPer1K:.4,supportsThinking:!1},{id:"claude-3-opus-20240229",displayName:"Claude 3 Opus",description:"Previous generation flagship model",contextWindow:2e5,inputPricing:"$15.00 / 1M tokens",outputPricing:"$75.00 / 1M tokens",promptTokenCostPer1K:1.5,completionTokenCostPer1K:7.5,supportsThinking:!1}]},openrouter:{name:"openrouter",displayName:"OpenRouter",defaultModel:"gpt-4o",supportedAttachmentTypes:["image/png","image/jpeg","image/gif","image/webp"],models:[{id:"openai/o4-mini",displayName:"OpenRouter GPT-4o Mini",description:"Affordable and intelligent small model",contextWindow:128e3,inputPricing:"$1.100 / 1M tokens",outputPricing:"$4.400 / 1M tokens",promptTokenCostPer1K:.11,completionTokenCostPer1K:.44,supportsThinking:!1},{id:"qwen/qwen3-32b:free",displayName:"OpenRouter Qwen 32B",description:"Large model with advanced capabilities",contextWindow:2e5,inputPricing:"$0.002 / 1M tokens",outputPricing:"$0.002 / 1M tokens",promptTokenCostPer1K:.002,completionTokenCostPer1K:.002,supportsThinking:!1},{id:"google/gemini-2.0-flash-exp:free",displayName:"OpenRouter Gemini 2.0 Flash",description:"Large model with advanced capabilities",contextWindow:2e5,inputPricing:"$0.002 / 1M tokens",outputPricing:"$0.002 / 1M tokens",promptTokenCostPer1K:.002,completionTokenCostPer1K:.002,supportsThinking:!1}]}};function pt(){return Object.values(ft)}function gn(u){return ft[u]}function fn(u,n){const r=gn(u),l=r==null?void 0:r.models.find(a=>a.id===n);return(l==null?void 0:l.displayName)||n}function pn(){return pt().map(u=>({name:u.name,displayName:u.displayName,models:u.models.map(n=>n.id),defaultModel:u.defaultModel}))}function He(u){for(const n of pt()){const r=n.models.find(l=>l.id===u);if(r)return r}return null}function mn(u){const n=He(u);return(n==null?void 0:n.supportsReasoningEffort)||!1}function hn(u){const n=He(u);return(n==null?void 0:n.reasoningEffortLevels)||[]}function wn(u){const n=He(u);return(n==null?void 0:n.defaultReasoningEffort)||null}class _n{async getProviders(){return pn()}async switchProvider(n,r,l){if(!n)return console.log("ðŸ”„ Provider switch for new conversation - will use when creating conversation"),Promise.resolve();try{const a=await gt.test["switch-provider"].$post({json:{conversationId:n,provider:r,model:l}});if(!a.ok){const s=await a.json().catch(()=>({error:a.statusText}));throw new Error(s.error||`Failed to switch provider: ${a.statusText}`)}const i=await a.json();if(!i.success)throw new Error(i.message||"Failed to switch provider")}catch(a){throw console.error("Error switching provider:",a),a}}getModelDisplayName(n,r){return fn(n,r)}}const Ne=new _n;var xn=_("<span> </span> <!>",1),yn=_("<!> ",1),bn=_('<div class="flex items-center gap-1"><!> <!></div>'),kn=_('<div class="flex items-center justify-center py-2"><!> <span class="ml-2 text-xs">Loading...</span></div>'),Pn=_('<div class="py-2 text-center"><p class="text-destructive text-xs"> </p> <!></div>'),Cn=_('<div class="py-2 text-center"><p class="text-muted-foreground text-xs">No providers available</p></div>'),$n=_('<span class="truncate"> </span> <!>',1),Mn=_('<div class="py-2 text-center"><p class="text-muted-foreground text-xs">No models found</p></div>'),Sn=_('<div class="relative mb-2"><!> <!></div> <div class="space-y-2"><!> <!></div>',1),Tn=_('<div class="relative" data-provider-selector=""><div class="flex items-center gap-2"><!> <!></div> <!></div>');function In(u,n){_e(n,!0);let r=U(n,"currentProvider",3,"anthropic"),l=U(n,"currentModel",3,"claude-sonnet-4-20250514"),a=U(n,"disabled",3,!1),i=S(Pe([])),s=S(!1),p=S(null),I=S(!1),T=S(!1),P=S("");Ue(async()=>{console.log("on mount"),await E()});async function E(){console.log("laoding providers");try{o(s,!0),o(p,null),o(i,await Ne.getProviders(),!0),console.log(e(i))}catch(h){o(p,h instanceof Error?h.message:"Failed to load providers",!0),console.error("Failed to load providers:",h)}finally{o(s,!1)}}async function D(h,k){var y;if(!(e(T)||a()))try{o(T,!0),o(p,null),n.conversationId&&await Ne.switchProvider(n.conversationId,h,k),(y=n.onProviderChange)==null||y.call(n,h,k),o(I,!1)}catch($){o(p,$ instanceof Error?$.message:"Failed to switch provider",!0),console.error("Failed to switch provider:",$)}finally{o(T,!1)}}function x(){const h=e(i).find(k=>k.name===r());return{providerName:(h==null?void 0:h.displayName)||r(),modelName:h?Ne.getModelDisplayName(r(),l()):l()}}let b=fe(()=>e(i).map(h=>({...h,models:h.models.filter(k=>{if(!e(P).trim())return!0;const y=e(P).toLowerCase(),$=Ne.getModelDisplayName(h.name,k).toLowerCase(),v=h.displayName.toLowerCase();return $.includes(y)||v.includes(y)||k.toLowerCase().includes(y)})})).filter(h=>h.models.length>0));Re(()=>{function h(k){const y=k.target;y!=null&&y.closest("[data-provider-selector]")||o(I,!1)}if(e(I))return document.addEventListener("click",h),()=>document.removeEventListener("click",h)});var M=Tn(),R=f(M),K=f(R);ue(K,{variant:"ghost",size:"sm",class:"h-8 justify-between gap-1 px-2 text-xs font-medium",onclick:()=>o(I,!e(I)),get disabled(){return a()},children:(h,k)=>{var y=xn(),$=W(y),v=f($,!0);g($);var w=m($,2);{var C=F=>{nt(F,{class:"h-3 w-3 animate-spin"})},A=F=>{const ee=fe(()=>e(I)?"rotate-180":"");Ge(F,{get class(){return`h-3 w-3 ${e(ee)??""} transition-transform`}})};B(w,F=>{e(T)?F(C):F(A,!1)})}ve(F=>ge(v,F),[()=>e(s)?"Loading...":x().modelName]),c(h,y)},$$slots:{default:!0}});var Z=m(K,2);{var G=h=>{var k=bn(),y=f(k);et(y,{variant:"outline",class:"h-6 px-1.5 text-xs",children:(w,C)=>{var A=yn(),F=W(A);en(F,{class:"mr-1 h-2.5 w-2.5"});var ee=m(F);ve(J=>ge(ee,` $${J??""}`),[()=>(n.userSettings.credits/100).toFixed(2)]),c(w,A)},$$slots:{default:!0}});var $=m(y,2);{var v=w=>{et(w,{variant:"destructive",class:"h-6 px-1.5 text-xs",children:(C,A)=>{ie();var F=Ee("Low");c(C,F)},$$slots:{default:!0}})};B($,w=>{n.userSettings.credits<=10&&w(v)})}g(k),c(h,k)};B(Z,h=>{n.userSettings&&h(G)})}g(R);var L=m(R,2);{var X=h=>{var k=le(),y=W(k);ye(y,()=>vt,($,v)=>{v($,{class:"absolute bottom-full left-0 z-[100] mb-2 w-64 shadow-lg",children:(w,C)=>{var A=le(),F=W(A);ye(F,()=>ut,(ee,J)=>{J(ee,{class:"px-3 pt-0 pb-3",children:(de,se)=>{var z=le(),te=W(z);{var ae=Y=>{var O=kn(),j=f(O);nt(j,{class:"h-3 w-3 animate-spin"}),ie(2),g(O),c(Y,O)},ce=(Y,O)=>{{var j=Q=>{var H=Pn(),ne=f(H),oe=f(ne,!0);g(ne);var re=m(ne,2);ue(re,{variant:"outline",size:"sm",class:"mt-1 h-6 text-xs",onclick:E,children:(he,t)=>{ie();var d=Ee("Retry");c(he,d)},$$slots:{default:!0}}),g(H),ve(()=>ge(oe,e(p))),c(Q,H)},q=(Q,H)=>{{var ne=re=>{var he=Cn();c(re,he)},oe=re=>{var he=Sn(),t=W(he),d=f(t);rn(d,{class:"text-muted-foreground absolute top-1/2 left-2 h-3 w-3 -translate-y-1/2"});var N=m(d,2);dt(N,{placeholder:"Search models...",class:"h-7 pl-7 text-xs",get value(){return e(P)},set value(me){o(P,me,!0)}}),g(t);var V=m(t,2),be=f(V);Fe(be,17,()=>e(b),me=>me.name,(me,Ie)=>{var Ve=le(),mt=W(Ve);Fe(mt,16,()=>e(Ie).models,We=>We,(We,Le)=>{const Je=fe(()=>r()===e(Ie).name&&l()===Le),ht=fe(()=>e(Je)?"default":"ghost");ue(We,{get variant(){return e(ht)},size:"sm",class:"h-6 w-full justify-start px-2 text-xs",onclick:()=>D(e(Ie).name,Le),get disabled(){return e(T)},children:(wt,Po)=>{var qe=$n(),ze=W(qe),_t=f(ze,!0);g(ze);var xt=m(ze,2);{var yt=Ae=>{ct(Ae,{class:"ml-auto h-3 w-3"})};B(xt,Ae=>{e(Je)&&Ae(yt)})}ve(Ae=>ge(_t,Ae),[()=>Ne.getModelDisplayName(e(Ie).name,Le)]),c(wt,qe)},$$slots:{default:!0}})}),c(me,Ve)});var pe=m(be,2);{var we=me=>{var Ie=Mn();c(me,Ie)};B(pe,me=>{e(b).length===0&&me(we)})}g(V),c(re,he)};B(Q,re=>{e(i).length===0?re(ne):re(oe,!1)},H)}};B(Y,Q=>{e(p)?Q(j):Q(q,!1)},O)}};B(te,Y=>{e(s)?Y(ae):Y(ce,!1)})}c(de,z)},$$slots:{default:!0}})}),c(w,A)},$$slots:{default:!0}})}),c(h,k)};B(L,h=>{e(I)&&h(X)})}g(M),c(u,M),xe()}var An=_('<!> <span class="hidden sm:inline"> </span> <!>',1),Nn=(u,n,r)=>n(r),En=_('<div class="h-2 w-2 rounded-full bg-primary"></div>'),Rn=_('<button type="button" class="flex w-full items-center justify-between rounded-sm px-2 py-1.5 text-sm hover:bg-accent hover:text-accent-foreground"><span> </span> <!></button>'),Fn=_('<div class="absolute bottom-full left-0 z-50 min-w-[120px] mb-1 rounded-md border bg-card shadow-md p-1"></div>'),Wn=_('<div class="relative"><!> <!></div>');function Ln(u,n){_e(n,!0);let r=U(n,"modelId",3,"");U(n,"provider",3,"");let l=U(n,"reasoningEffort",15,"medium"),a=U(n,"onReasoningEffortChange",3,()=>{}),i=U(n,"disabled",3,!1),s=fe(()=>mn(r())),p=fe(()=>hn(r())),I=fe(()=>wn(r())),T=S(!1);Re(()=>{e(s)&&!l()&&e(I)&&(l(e(I)),a()(l()))});function P(M){l(M),a()(M),o(T,!1)}function E(M){return M.charAt(0).toUpperCase()+M.slice(1)}var D=le(),x=W(D);{var b=M=>{var R=Wn(),K=f(R);ue(K,{variant:"ghost",size:"sm",class:"h-8 px-2 text-xs",onclick:()=>o(T,!e(T)),get disabled(){return i()},children:(L,X)=>{var h=An(),k=W(h);an(k,{class:"h-3 w-3 mr-1"});var y=m(k,2),$=f(y,!0);g(y);var v=m(y,2);Ge(v,{class:"h-3 w-3 ml-1"}),ve(w=>ge($,w),[()=>E(l())]),c(L,h)},$$slots:{default:!0}});var Z=m(K,2);{var G=L=>{var X=Fn();Fe(X,20,()=>e(p),h=>h,(h,k)=>{var y=Rn();y.__click=[Nn,P,k];var $=f(y),v=f($,!0);g($);var w=m($,2);{var C=A=>{var F=En();c(A,F)};B(w,A=>{l()===k&&A(C)})}g(y),ve(A=>ge(v,A),[()=>E(k)]),c(h,y)}),g(X),c(L,X)};B(Z,L=>{e(T)&&L(G)})}g(R),c(M,R)};B(x,M=>{e(s)&&e(p).length>0&&M(b)})}c(u,D),xe()}je(["click"]);async function zn(u,n){const r=u.target;r.files&&await n(Array.from(r.files))}var Dn=_("<!> Attach",1),Kn=_('<div class="bg-muted/20 flex items-center gap-2 rounded p-2 text-xs"><!> <div class="min-w-0 flex-1"><div class="truncate font-medium"> </div> <div class="text-muted-foreground"> </div></div> <!></div>'),On=_('<div class="mt-3"><div class="mb-1 flex items-center justify-between text-xs"><span>Uploading...</span> <span> </span></div> <div class="bg-muted h-2 w-full rounded-full"><div class="bg-primary h-2 rounded-full transition-all duration-300"></div></div></div>'),jn=_("<!> ",1),Un=_('<div class="mt-3 flex gap-2"><!></div>'),Bn=_('<div class="bg-background border-border absolute bottom-full left-0 z-50 mb-2 w-80 rounded-lg border p-3 shadow-lg"><div class="mb-3 flex items-center justify-between"><h4 class="text-sm font-medium">Selected Files</h4> <!></div> <div class="max-h-40 space-y-2 overflow-y-auto"></div> <!></div>'),Gn=_('<div class="bg-background/80 fixed inset-0 z-50 flex items-center justify-center backdrop-blur-sm"><div class="border-primary bg-background rounded-lg border-2 border-dashed p-8 text-center"><!> <p class="text-lg font-medium">Drop files here to attach</p> <p class="text-muted-foreground text-sm">Up to 10MB per file</p></div></div>'),Hn=_('<div class="relative"><input type="file" multiple class="hidden"/> <!> <!> <!></div>');function Vn(u,n){_e(n,!0);let r,l=S(!1),a=S(!1),i=S(0),s=S(Pe([])),p=S(!1);const I=10*1024*1024,T=["image/*","text/*","application/pdf","application/json","application/xml","application/zip","video/*","audio/*"];function P(){r==null||r.click()}async function E(v){const w=v.filter(C=>C.size>I?(Oe(`File "${C.name}" is too large. Maximum size is 10MB.`,{icon:Ye}),!1):!0);w.length>0&&(n.ensureMessageId&&await n.ensureMessageId(),o(s,[...e(s),...w],!0),o(p,!0))}function D(v){o(s,e(s).filter((w,C)=>C!==v),!0),e(s).length===0&&o(p,!1)}async function x(){if(!(!n.conversationId||e(s).length===0)){o(a,!0),o(i,0);try{const v=e(s).map(async(C,A)=>{const F=await Bt(C,n.conversationId);return o(i,(A+1)/e(s).length*100),F}),w=await Promise.all(v);w.forEach(C=>{n.onAttachmentUploaded(C)}),o(s,[],!0),o(p,!1),Oe(`Successfully uploaded ${w.length} file${w.length!==1?"s":""}`,{icon:ct})}catch(v){console.error("Upload failed:",v),Oe("Upload failed. Please try again.",{icon:Ye})}finally{o(a,!1),o(i,0)}}}function b(v){v.preventDefault(),o(l,!0)}function M(v){v.preventDefault(),o(l,!1)}async function R(v){var w;v.preventDefault(),o(l,!1),(w=v.dataTransfer)!=null&&w.files&&await E(Array.from(v.dataTransfer.files))}function K(v){return v.type.startsWith("image/")?Dt:v.type.startsWith("video/")?Kt:v.type.startsWith("audio/")?Ot:v.type.includes("text")||v.type.includes("json")||v.type.includes("xml")?jt:Ut}function Z(v){if(v===0)return"0 Bytes";const w=1024,C=["Bytes","KB","MB","GB"],A=Math.floor(Math.log(v)/Math.log(w));return parseFloat((v/Math.pow(w,A)).toFixed(2))+" "+C[A]}var G=Hn();Te("dragover",De,b),Te("dragleave",De,M),Te("drop",De,R);var L=f(G);L.__change=[zn,E],Be(L,v=>r=v,()=>r);var X=m(L,2);ue(X,{variant:"ghost",size:"sm",class:"h-8 px-2 text-xs",onclick:P,get disabled(){return n.disabled},children:(v,w)=>{var C=Dn(),A=W(C);ln(A,{class:"mr-1 h-3 w-3"}),ie(),c(v,C)},$$slots:{default:!0}});var h=m(X,2);{var k=v=>{var w=Bn(),C=f(w),A=m(f(C),2);ue(A,{variant:"ghost",size:"sm",class:"h-6 w-6 p-0",onclick:()=>{o(s,[],!0),o(p,!1)},children:(se,z)=>{ot(se,{class:"h-3 w-3"})},$$slots:{default:!0}}),g(C);var F=m(C,2);Fe(F,21,()=>e(s),Xt,(se,z,te)=>{var ae=Kn(),ce=f(ae);ye(ce,()=>K(e(z)),(ne,oe)=>{oe(ne,{class:"text-muted-foreground h-4 w-4"})});var Y=m(ce,2),O=f(Y),j=f(O,!0);g(O);var q=m(O,2),Q=f(q,!0);g(q),g(Y);var H=m(Y,2);ue(H,{variant:"ghost",size:"sm",class:"h-6 w-6 p-0",onclick:()=>D(te),children:(ne,oe)=>{ot(ne,{class:"h-3 w-3"})},$$slots:{default:!0}}),g(ae),ve(ne=>{ge(j,e(z).name),ge(Q,ne)},[()=>Z(e(z).size)]),c(se,ae)}),g(F);var ee=m(F,2);{var J=se=>{var z=On(),te=f(z),ae=m(f(te),2),ce=f(ae);g(ae),g(te);var Y=m(te,2),O=f(Y);g(Y),g(z),ve(j=>{ge(ce,`${j??""}%`),Yt(O,`width: ${e(i)??""}%`)},[()=>Math.round(e(i))]),c(se,z)},de=se=>{var z=Un(),te=f(z);const ae=fe(()=>e(s).length===0||!n.conversationId);ue(te,{size:"sm",class:"flex-1",onclick:x,get disabled(){return e(ae)},children:(ce,Y)=>{var O=jn(),j=W(O);lt(j,{class:"mr-1 h-3 w-3"});var q=m(j);ve(()=>ge(q,` Upload ${e(s).length??""} file${e(s).length!==1?"s":""}`)),c(ce,O)},$$slots:{default:!0}}),g(z),c(se,z)};B(ee,se=>{e(a)?se(J):se(de,!1)})}g(w),c(v,w)};B(h,v=>{e(p)&&v(k)})}var y=m(h,2);{var $=v=>{var w=Gn(),C=f(w),A=f(C);lt(A,{class:"text-primary mx-auto mb-2 h-8 w-8"}),ie(4),g(C),g(w),Te("dragover",w,b),Te("dragleave",w,M),Te("drop",w,R),c(v,w)};B(y,v=>{e(l)&&v($)})}g(G),ve(v=>Zt(L,"accept",v),[()=>T.join(",")]),c(u,G),xe()}je(["change"]);function Jn(u,n){u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),n.onSendMessage())}var qn=_('<div class="px-3 pt-3"><div class="text-muted-foreground mb-2 text-xs"> </div> <!></div>'),Qn=_('<div class="h-3 w-3 animate-spin rounded-full border-2 border-current border-t-transparent"></div>'),Zn=_('<div class="bg-background/80 absolute right-0 bottom-0 left-0 z-10 px-4 backdrop-blur-[2px]"><div class="relative mx-auto max-w-sm sm:max-w-lg md:max-w-2xl lg:max-w-4xl xl:max-w-5xl"><div class="bg-muted/10 relative overflow-visible rounded-t-lg border border-b-0"><div class="to-background/25 pointer-events-none absolute -top-6 right-0 left-0 h-6 bg-gradient-to-t from-transparent"></div> <!> <textarea placeholder="Type your message here..." class="placeholder:text-muted-foreground/60 min-h-[80px] w-full resize-none border-0 bg-transparent px-3 py-3 text-base focus:ring-0 focus:outline-none"></textarea> <div class="flex items-center justify-between bg-transparent px-3 py-2"><div class="flex items-center gap-2"><!> <!>  <!></div> <!></div></div> <div class="bg-muted/10 h-1 border-r border-l"></div></div></div>');function Xn(u,n){_e(n,!0);let r=U(n,"inputValue",15,""),l=U(n,"isConnected",11,!1),a=U(n,"isStreaming",11,!1),i=U(n,"conversationId",11,null),s=U(n,"currentProvider",11,"anthropic"),p=U(n,"currentModel",11,"claude-sonnet-4-20250514"),I=U(n,"reasoningEffort",11,"medium"),T=U(n,"pendingAttachments",27,()=>Pe([])),P=U(n,"currentMessageAttachments",27,()=>Pe([])),E=U(n,"pendingMessageId",11,null),D=fe(()=>T().length+P().length);var x=Zn(),b=f(x),M=f(b),R=m(f(M),2);{var K=v=>{var w=qn(),C=f(w),A=f(C);g(C);var F=m(C,2);const ee=fe(()=>[...T(),...P()]);Gt(F,{get attachments(){return e(ee)}}),g(w),ve(()=>ge(A,`Attachments (${T().length??""} pending, ${P().length??""} for
						message, total: ${e(D)??""}):`)),c(v,w)};B(R,v=>{e(D)>0&&v(K)})}var Z=m(R,2);Pt(Z),Z.__keydown=[Jn,n];var G=m(Z,2),L=f(G),X=f(L);In(X,{get currentProvider(){return s()},get currentModel(){return p()},get conversationId(){return i()},get onProviderChange(){return n.onProviderChange},get disabled(){return a()},get userSettings(){return n.userSettings}});var h=m(X,2);Ln(h,{get modelId(){return p()},get provider(){return s()},get reasoningEffort(){return I()},get onReasoningEffortChange(){return n.onReasoningEffortChange},get disabled(){return a()}});var k=m(h,2);Vn(k,{get conversationId(){return i()},get messageId(){return E()},get disabled(){return a()},get onAttachmentUploaded(){return n.onAttachmentUploaded},get ensureMessageId(){return n.ensureMessageId}}),g(L);var y=m(L,2);const $=fe(()=>!l()||a()||!r().trim());ue(y,{get onclick(){return n.onSendMessage},get disabled(){return e($)},size:"sm",class:"h-8",children:(v,w)=>{var C=le(),A=W(C);{var F=J=>{var de=Qn();c(J,de)},ee=J=>{dn(J,{class:"h-3 w-3"})};B(A,J=>{a()?J(F):J(ee,!1)})}c(v,C)},$$slots:{default:!0}}),g(G),g(M),ie(2),g(b),g(x),ve(()=>Z.disabled=!l()||a()),Vt(Z,r),c(u,x),xe()}je(["keydown"]);var Yn=_('<div class="mx-auto max-w-4xl svelte-buhjx7"><div class="mb-4 svelte-buhjx7"><details class="bg-muted/20 border-border/30 rounded-lg border svelte-buhjx7" open><summary class="text-muted-foreground hover:bg-muted/30 cursor-pointer rounded-lg p-3 text-sm font-medium transition-colors svelte-buhjx7">Reasoning...</summary> <div class="text-muted-foreground border-border/20 mt-2 border-t px-3 pt-1 pb-3 font-mono text-xs leading-relaxed whitespace-pre-wrap svelte-buhjx7"> </div></details></div></div>');function eo(u,n){_e(n,!0);let r=U(n,"isThinking",11,!1),l=U(n,"currentThinkingContent",11,""),a=U(n,"thinkingMessageId",11,null);var i=le(),s=W(i);{var p=I=>{var T=Yn(),P=f(T),E=f(P),D=m(f(E),2),x=f(D,!0);g(D),g(E),g(P),g(T),ve(()=>ge(x,l())),c(I,T)};B(s,I=>{r()&&l()&&a()&&I(p)})}c(u,i),xe()}var to=_('<div class="mx-auto max-w-4xl svelte-1yghze7"><div class="pt-6 pb-2 text-base leading-7 svelte-1yghze7"><span class="terminal-cursor font-mono text-lg text-current svelte-1yghze7"><span class="cursor-bar cursor-bar-1 svelte-1yghze7">|</span> <span class="cursor-bar cursor-bar-2 svelte-1yghze7">|</span> <span class="cursor-bar cursor-bar-3 svelte-1yghze7">|</span></span></div></div>'),no=_('<span class="svelte-1yghze7">Scroll to bottom</span> <!>',1),oo=_('<div class="absolute bottom-40 left-1/2 z-20 -translate-x-1/2 transform svelte-1yghze7"><!></div>'),ro=_("<!> <!>",1);function so(u,n){_e(n,!0);let r=U(n,"isWaitingForResponse",11,!1),l=U(n,"showScrollButton",11,!1),a=U(n,"isThinking",3,!1);var i=ro(),s=W(i);{var p=P=>{var E=to();c(P,E)};B(s,P=>{(r()||a())&&P(p)})}var I=m(s,2);{var T=P=>{var E=oo(),D=f(E);ue(D,{get onclick(){return n.onScrollToBottom},variant:"secondary",size:"sm",class:"bg-background hover:bg-accent flex h-8 items-center gap-1 rounded-full px-3 py-1 text-xs shadow-lg transition-all hover:shadow-xl",children:(x,b)=>{var M=no(),R=m(W(M),2);Ge(R,{class:"h-3 w-3"}),c(x,M)},$$slots:{default:!0}}),g(E),c(P,E)};B(I,P=>{l()&&P(T)})}c(u,i),xe()}var ao=_('<div class="relative h-screen"><div class="h-full overflow-x-visible overflow-y-auto p-4 pb-40"><!> <!> <!></div> <!></div>');function io(u,n){_e(n,!0);const[r,l]=It(),a=()=>At(Nt,"$page",r);let i,s=S(Pe([])),p="",I=S(""),T=S(!1),P=S(!1),E=S(!1),D=S(null),x=null,b=S(null),M=S(!1),R=S(""),K=S(null),Z=S(Pe(new Map)),G=S("anthropic"),L=S("claude-sonnet-4-20250514"),X=S("medium"),h=S(!1),k,y=S(Pe([])),$=S(null),v=S(Pe([])),w=S(null);const C=Mt("conversation-refresh"),A=C==null?void 0:C();let F=fe(()=>e($)?e(v).filter(t=>t.messageId===e($)).map(t=>t.attachment):[]),ee=fe(()=>a().url.searchParams.get("c")),J=null,de=!1;Re(async()=>{const t=e(ee);if(t!==J&&!de){if(de=!0,J=t,o(D,t,!0),o(b,null),o(s,[],!0),o(P,!1),x=null,p="",o(M,!1),o(R,""),o(K,null),e(Z).clear(),i&&i.isConnected())try{t&&(o(b,await Ke(t),!0),e(b)?(o(G,e(b).provider||"openai",!0),o(L,e(b).model||"gpt-4.1-mini",!0)):console.log("ðŸ†• New conversation with pre-generated ID:",t)),console.log("ðŸ”„ Requesting conversation switch via WebSocket:",t),i.switchConversation(t)}catch(d){console.error("Failed to load conversation:",d)}else if(t)try{o(b,await Ke(t),!0),e(b)?(o(G,e(b).provider||"openai",!0),o(L,e(b).model||"gpt-4.1-mini",!0)):console.log("ðŸ†• New conversation with pre-generated ID:",t)}catch(d){console.error("Failed to load conversation from local SQLite:",d)}de=!1}});async function se(){try{const t=await gt["user-settings"].$get();if(t.ok){const d=await t.json();o(w,{credits:d.credits},!0)}}catch(t){console.error("Failed to load user settings:",t)}}Ue(async()=>{await se(),i=new cn,i.on("connected",()=>{console.log("ðŸ”Œ WebSocket connected"),o(T,!0),rt(!0)}),i.on("disconnected",()=>{console.log("ðŸ”Œ WebSocket disconnected"),o(T,!1),rt(!1)}),i.on("conversation_switched",async t=>{if(console.log("ðŸ”„ Received conversation_switched:",t),t.conversationId){if(t.conversation&&(o(b,{id:t.conversation.id,title:t.conversation.title,model:t.conversation.model,provider:t.conversation.provider,createdAt:new Date(t.conversation.createdAt),updatedAt:new Date(t.conversation.updatedAt)},!0),o(G,e(b).provider||"anthropic",!0),o(L,e(b).model||"claude-sonnet-4-20250514",!0)),t.messages&&o(s,t.messages.map(d=>({id:d.id,role:d.role,content:d.content,isStreaming:d.isStreaming||!1,streamCompleted:d.streamCompleted!==!1})),!0),t.hasActiveStream){o(P,!0);const d=e(s).find(N=>N.isStreaming);d&&(x=d.id,p=d.content)}}else o(b,null),o(s,[],!0),o(P,!1),x=null,p="",o(M,!1),o(R,""),o(K,null),e(Z).clear()}),i.on("conversation_updated",async t=>{console.log("ðŸ”„ Received conversation_updated:",t),t.conversation&&t.conversation.id===e(D)&&(o(b,{id:t.conversation.id,title:t.conversation.title,model:t.conversation.model,provider:t.conversation.provider,createdAt:new Date(t.conversation.createdAt),updatedAt:new Date(t.conversation.updatedAt)},!0),await Ze(t.conversation.id,t.conversation.title),console.log("âœ… Updated conversation title:",t.conversation.title),window.dispatchEvent(new CustomEvent("conversation-title-updated",{detail:{conversationId:t.conversation.id,title:t.conversation.title}})))}),i.on("text",async t=>{if(console.log("ðŸ“¥ Received text message:",t),t.content){const d=t.messageId||x;console.log("ðŸŽ¯ Processing text for message:",d,"current streaming:",x),d&&(d===x&&(p+=t.content,console.log("ðŸ“ Updated currentMessage length:",p.length)),o(s,e(s).map(N=>{if(N.id===d){const V=d===x?p:N.content+t.content;return{...N,content:V}}return N}),!0))}}),i.on("done",async t=>{console.log("âœ… Received done message:",t);const d=t.messageId||x;d===x&&(console.log("ðŸ Stopping streaming for message:",d),o(E,!1),o(P,!1),x=null,p=""),d&&o(s,e(s).map(N=>N.id===d?{...N,streaming:!1,isStreaming:!1,streamCompleted:!0,usage:t.usage||N.usage}:N),!0)}),i.on("catchup",t=>{if(t.messages&&o(s,t.messages.map(d=>({id:d.id,role:d.role,content:d.content,streaming:d.isStreaming})),!0),t.hasActiveStream){o(P,!0);const d=e(s).find(N=>N.streaming);d&&(x=d.id,p=d.content)}}),i.on("new_message",async t=>{if(console.log("ðŸ“¨ Received new_message:",t),t.message){const d={id:t.message.id,role:t.message.role,content:t.message.content,model:t.message.model,provider:t.message.provider,streaming:t.message.streaming||!1};console.log("âž• Adding new message to UI:",d),o(s,[...e(s),d],!0),d.streaming&&d.role==="assistant"&&(console.log("ðŸŽ¯ Setting currentStreamingMessageId:",d.id),o(P,!0),x=d.id,p=d.content)}}),i.on("error",t=>{console.error("âŒ Chat error:",t.message),o(E,!1),o(P,!1),o(M,!1)}),i.on("thinking_start",t=>{console.log("ðŸ§  Thinking phase started:",t),o(M,!0),o(E,!1),o(R,""),o(K,t.messageId||x,!0)}),i.on("thinking",t=>{console.log("ðŸ§  Received thinking token:",t),t.content&&o(R,e(R)+t.content)}),i.on("thinking_end",t=>{console.log("ðŸ§  Thinking phase ended:",t);const d=t.messageId||e(K);d&&e(R)&&e(Z).set(d,e(R))}),i.on("response_start",t=>{console.log("ðŸ’¬ Response phase started:",t),o(M,!1),o(E,!1)});try{await i.connect()}catch(t){console.error("Failed to connect:",t)}}),St(()=>{i&&i.disconnect()});let z=!1;async function te(){if(!e($)){const{uuidv7:t}=await Qe(async()=>{const{uuidv7:d}=await import("../chunks/D8HI6Bhs.js").then(N=>N.k);return{uuidv7:d}},__vite__mapDeps([0,1,2,3]),import.meta.url);o($,t(),!0)}return e($)}async function ae(t){console.log("Attachment uploaded:",t),console.log("Current pendingMessageId:",e($)),console.log("Current pendingAttachments length:",e(y).length),e($)?(e(v).push({attachment:t,messageId:e($)}),console.log("Added to allAttachments for message:",e($),"total:",e(v).length)):(o(y,[...e(y),t],!0),console.log("Added to pendingAttachments, new length:",e(y).length))}async function ce(){if(console.log("ðŸš€ sendMessage called"),console.log("ðŸ“‹ State check:",{inputValue:e(I).trim(),isConnected:e(T),isStreaming:e(P),isCreatingConversation:z,conversationId:e(D)}),!e(I).trim()||!e(T)||e(P)||z){console.log("âŒ sendMessage early return - conditions not met");return}const t=e(I).trim();o(I,""),console.log("ðŸ’¬ Message content:",t);try{const{uuidv7:d}=await Qe(async()=>{const{uuidv7:pe}=await import("../chunks/D8HI6Bhs.js").then(we=>we.k);return{uuidv7:pe}},__vite__mapDeps([0,1,2,3]),import.meta.url),N=e($)||d();console.log("ðŸŽ² Generated/using message ID:",N);let V=e(D);console.log("ðŸ†” Current conversation ID:",V);let be=!1;if(!V&&!z?(console.log("ðŸ†• Creating new conversation (no ID)"),be=!0,z=!0,V=d(),console.log("ðŸŽ² Generated conversation ID:",V)):V&&!e(b)&&!z&&(console.log("ðŸ†• Creating new conversation (pre-assigned ID)"),be=!0,z=!0),be&&V){if(console.log("ðŸ’¾ Creating conversation with state:",{currentProvider:e(G),currentModel:e(L)}),await Rt({id:V,title:"...",model:e(L),provider:e(G)}),console.log("ðŸ’¾ Created conversation in local database"),A?(console.log("ðŸ”„ Triggering sidebar refresh for new conversation"),A.trigger()):console.warn("âŒ conversationRefresh context not available"),J=V,o(D,V,!0),o(b,await Ke(V),!0),console.log("ðŸ“ Updated conversation state:",e(b)),!e(D)&&V){const pe=new URL(a().url);pe.searchParams.set("c",V),Et(pe.toString(),{replaceState:!0,noScroll:!0}),console.log("ðŸ”— Updated URL:",pe.toString())}z=!1}if(console.log("ðŸ”„ Setting waiting state"),o(E,!0),o(P,!1),console.log("ðŸ”„ isWaitingForResponse:",e(E)),p="",x=null,console.log("ðŸ“¤ Sending message via WebSocket:",{messageContent:t,messageId:N,conversationId:V,webSocketConnected:i==null?void 0:i.isConnected()}),i.startChat(t,V||void 0,N||void 0,e(G),e(L),e(X)),e(y).length>0&&N)for(const pe of e(y))e(v).push({attachment:pe,messageId:N});o($,null),o(y,[],!0)}catch(d){console.error("Failed to save message:",d)}}async function Y(t,d){if(console.log("ðŸ”„ Frontend Provider changed:",{provider:t,model:d,conversationId:e(D)}),console.log("ðŸ”„ State before change:",{currentProvider:e(G),currentModel:e(L)}),o(G,t,!0),o(L,d,!0),console.log("ðŸ”„ State after change:",{currentProvider:e(G),currentModel:e(L)}),e(b))try{await Ze(e(b).id,e(b).title),console.log("âœ… Provider switched successfully")}catch(N){console.error("Failed to update conversation locally:",N)}}function O(t){console.log("ðŸ§  Reasoning effort changed:",t),o(X,t,!0)}function j(){if(!k)return;const{scrollTop:t,scrollHeight:d,clientHeight:N}=k,V=d-t-N<150;o(h,!V&&e(s).length>0,!0)}function q(){k&&k.scrollTo({top:k.scrollHeight,behavior:"smooth"})}Re(()=>{k&&e(s).length>0&&setTimeout(()=>j(),50)});var Q=ao(),H=f(Q),ne=f(H);Ht(ne,{get conversationId(){return e(D)},get messages(){return e(s)},set messages(t){o(s,t,!0)},get allAttachments(){return e(v)},set allAttachments(t){o(v,t,!0)},get isStreaming(){return e(P)},set isStreaming(t){o(P,t,!0)},get reasoningHistory(){return e(Z)},set reasoningHistory(t){o(Z,t,!0)}});var oe=m(ne,2);eo(oe,{get isThinking(){return e(M)},set isThinking(t){o(M,t,!0)},get currentThinkingContent(){return e(R)},set currentThinkingContent(t){o(R,t,!0)},get thinkingMessageId(){return e(K)},set thinkingMessageId(t){o(K,t,!0)}});var re=m(oe,2);so(re,{get isThinking(){return e(M)},onScrollToBottom:q,get isWaitingForResponse(){return e(E)},set isWaitingForResponse(t){o(E,t,!0)},get showScrollButton(){return e(h)},set showScrollButton(t){o(h,t,!0)}}),g(H),Be(H,t=>k=t,()=>k);var he=m(H,2);Xn(he,{onSendMessage:ce,onProviderChange:Y,onReasoningEffortChange:O,onAttachmentUploaded:ae,ensureMessageId:te,get userSettings(){return e(w)},get inputValue(){return e(I)},set inputValue(t){o(I,t,!0)},get isConnected(){return e(T)},set isConnected(t){o(T,t,!0)},get isStreaming(){return e(P)},set isStreaming(t){o(P,t,!0)},get conversationId(){return e(D)},set conversationId(t){o(D,t,!0)},get currentProvider(){return e(G)},set currentProvider(t){o(G,t,!0)},get currentModel(){return e(L)},set currentModel(t){o(L,t,!0)},get reasoningEffort(){return e(X)},set reasoningEffort(t){o(X,t,!0)},get pendingAttachments(){return e(y)},set pendingAttachments(t){o(y,t,!0)},get currentMessageAttachments(){return e(F)},set currentMessageAttachments(t){o(F,t,!0)},get pendingMessageId(){return e($)},set pendingMessageId(t){o($,t,!0)}}),g(Q),Te("scroll",H,j),c(u,Q),xe(),l()}var lo=_('<div class="bg-primary/10 mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full"><!></div> <!> <!>',1),co=_("<!> Continue with GitHub",1),uo=_("<!> Login with Code",1),vo=_("<!> Start Chatting as Guest",1),go=_('<div class="space-y-2"><!> <!></div>'),fo=_('<p class="text-destructive text-sm"> </p>'),po=_('<span class="mr-2 h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"></span>'),mo=_("<!> Login",1),ho=_('<div class="space-y-3"><div class="space-y-2"><!> <!></div> <div class="flex gap-2"><!> <!></div></div>'),wo=_('<!> <div class="relative"><div class="absolute inset-0 flex items-center"><span class="border-border/20 w-full border-t"></span></div> <div class="relative flex justify-center text-xs uppercase"><span class="text-muted-foreground px-2">Or</span></div></div> <!>',1),_o=_('<p class="text-muted-foreground text-xs">By continuing, you agree to our Terms of Service and Privacy Policy.</p>'),xo=_("<!> <!> <!>",1),yo=_('<div class="bg-background flex min-h-screen items-center justify-center p-4"><div class="w-full max-w-md"><!> <div class="mt-8 grid grid-cols-1 gap-4 text-center sm:grid-cols-3"><div class="space-y-2"><div class="mx-auto flex h-8 w-8 items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900/20"><!></div> <h3 class="text-sm font-medium">AI Conversations</h3> <p class="text-muted-foreground text-xs">Chat with multiple AI models</p></div> <div class="space-y-2"><div class="mx-auto flex h-8 w-8 items-center justify-center rounded-full bg-green-100 dark:bg-green-900/20"><!></div> <h3 class="text-sm font-medium">Seamless Access</h3> <p class="text-muted-foreground text-xs">Quick setup with GitHub or guest mode</p></div> <div class="space-y-2"><div class="mx-auto flex h-8 w-8 items-center justify-center rounded-full bg-purple-100 dark:bg-purple-900/20"><!></div> <h3 class="text-sm font-medium">Persistent Chats</h3> <p class="text-muted-foreground text-xs">Save conversations with account</p></div></div></div></div>');function bo(u,n){_e(n,!0);let r=S(!1),l=S(""),a=S(!1),i=S(null);function s(){{const k=new URL("/oauth/login/github",location.href);k.protocol="https",window.location.href=k.toString()}}function p(){n.onStartAnonymous&&n.onStartAnonymous()}function I(){o(r,!e(r)),o(i,null),o(l,"")}async function T(){if(!e(l).trim()){o(i,"Please enter your login code");return}o(a,!0),o(i,null);try{const y=await fetch(`${sn?"http://localhost:5787":""}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({keyLogin:e(l).trim()}),credentials:"include"});if(y.ok)window.location.reload();else{const $=await y.json();o(i,$.error||"Login failed",!0)}}catch(k){console.error("Login error:",k),o(i,"Network error. Please try again.")}finally{o(a,!1)}}var P=yo(),E=f(P),D=f(E);ye(D,()=>vt,(k,y)=>{y(k,{class:"border-border/20 shadow-lg",children:($,v)=>{var w=xo(),C=W(w);ye(C,()=>tn,(ee,J)=>{J(ee,{class:"text-center",children:(de,se)=>{var z=lo(),te=W(z),ae=f(te);it(ae,{class:"text-primary h-6 w-6"}),g(te);var ce=m(te,2);ye(ce,()=>nn,(O,j)=>{j(O,{class:"text-2xl font-bold",children:(q,Q)=>{ie();var H=Ee("Welcome to DuraChat");c(q,H)},$$slots:{default:!0}})});var Y=m(ce,2);ye(Y,()=>on,(O,j)=>{j(O,{class:"text-muted-foreground",children:(q,Q)=>{ie();var H=Ee(`Start chatting with AI assistants. Sign in for a personalized experience or continue as a
					guest.`);c(q,H)},$$slots:{default:!0}})}),c(de,z)},$$slots:{default:!0}})});var A=m(C,2);ye(A,()=>ut,(ee,J)=>{J(ee,{class:"space-y-4",children:(de,se)=>{var z=wo(),te=W(z);ue(te,{onclick:s,class:"w-full",variant:"default",children:(O,j)=>{var q=co(),Q=W(q);st(Q,{class:"mr-2 h-4 w-4"}),ie(),c(O,q)},$$slots:{default:!0}});var ae=m(te,4);{var ce=O=>{var j=go(),q=f(j);ue(q,{onclick:I,class:"w-full",variant:"outline",children:(H,ne)=>{var oe=uo(),re=W(oe);tt(re,{class:"mr-2 h-4 w-4"}),ie(),c(H,oe)},$$slots:{default:!0}});var Q=m(q,2);ue(Q,{onclick:p,class:"w-full",variant:"outline",children:(H,ne)=>{var oe=vo(),re=W(oe);at(re,{class:"mr-2 h-4 w-4"}),ie(),c(H,oe)},$$slots:{default:!0}}),g(j),c(O,j)},Y=O=>{var j=ho(),q=f(j),Q=f(q);dt(Q,{placeholder:"Enter your login code",get disabled(){return e(a)},onkeydown:t=>{t.key==="Enter"&&T()},get value(){return e(l)},set value(t){o(l,t,!0)}});var H=m(Q,2);{var ne=t=>{var d=fo(),N=f(d,!0);g(d),ve(()=>ge(N,e(i))),c(t,d)};B(H,t=>{e(i)&&t(ne)})}g(q);var oe=m(q,2),re=f(oe);ue(re,{onclick:T,class:"flex-1",variant:"default",get disabled(){return e(a)},children:(t,d)=>{var N=mo(),V=W(N);{var be=we=>{var me=po();c(we,me)},pe=we=>{tt(we,{class:"mr-2 h-4 w-4"})};B(V,we=>{e(a)?we(be):we(pe,!1)})}ie(),c(t,N)},$$slots:{default:!0}});var he=m(re,2);ue(he,{onclick:I,variant:"outline",get disabled(){return e(a)},children:(t,d)=>{ie();var N=Ee("Back");c(t,N)},$$slots:{default:!0}}),g(oe),g(j),c(O,j)};B(ae,O=>{e(r)?O(Y,!1):O(ce)})}c(de,z)},$$slots:{default:!0}})});var F=m(A,2);ye(F,()=>vn,(ee,J)=>{J(ee,{class:"text-center",children:(de,se)=>{var z=_o();c(de,z)},$$slots:{default:!0}})}),c($,w)},$$slots:{default:!0}})});var x=m(D,2),b=f(x),M=f(b),R=f(M);it(R,{class:"h-4 w-4 text-blue-600 dark:text-blue-400"}),g(M),ie(4),g(b);var K=m(b,2),Z=f(K),G=f(Z);at(G,{class:"h-4 w-4 text-green-600 dark:text-green-400"}),g(Z),ie(4),g(K);var L=m(K,2),X=f(L),h=f(X);st(h,{class:"h-4 w-4 text-purple-600 dark:text-purple-400"}),g(X),ie(4),g(L),g(x),g(E),g(P),c(u,P),xe()}var ko=_('<div class="flex min-h-screen items-center justify-center"><div class="space-y-4 text-center"><div class="border-primary mx-auto h-8 w-8 animate-spin rounded-full border-2 border-t-transparent"></div> <div class="text-muted-foreground text-sm"> </div></div></div>');function jo(u,n){_e(n,!0);let r=S(!1),l=S(!0),a=S(null),i=S(!1);Ue(async()=>{await s()});async function s(){try{if(o(a,Ft(),!0),!e(a)){o(r,!1),o(l,!1);return}const[x,b]=await Promise.allSettled([Xe.initialize(e(a)),Wt()]);if(b.status==="fulfilled"&&b.value)if(x.status==="fulfilled")o(r,!0),o(i,!0);else throw console.error("Database initialization failed:",x.reason),new Error("Failed to initialize database");else console.log("Session verification failed, clearing session"),await p()}catch(x){console.error("App initialization failed:",x),await p()}finally{o(l,!1)}}async function p(){e(i)&&(await Xe.cleanup(),o(i,!1)),Lt(),o(a,null),o(r,!1)}async function I(){o(l,!0);try{await zt()&&await s()}catch(x){console.error("Failed to create anonymous session:",x)}finally{e(r)||o(l,!1)}}var T=le(),P=W(T);{var E=x=>{var b=ko(),M=f(b),R=m(f(M),2),K=f(R,!0);g(R),g(M),g(b),ve(()=>ge(K,e(a)?"Initializing database and verifying session...":"Loading...")),c(x,b)},D=(x,b)=>{{var M=K=>{io(K,{})},R=K=>{bo(K,{onStartAnonymous:I})};B(x,K=>{e(r)&&e(i)?K(M):K(R,!1)},b)}};B(P,x=>{e(l)?x(E):x(D,!1)})}c(u,T),xe()}export{jo as component};
