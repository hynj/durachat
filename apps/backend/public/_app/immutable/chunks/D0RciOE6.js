var kn=Object.defineProperty;var Vn=(r,t,e)=>t in r?kn(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var a=(r,t,e)=>Vn(r,typeof t!="symbol"?t+"":t,e);import{_ as Bi}from"./Dp1pzeXC.js";const mt="function",ie="64e10b34-2bf7-4616-9668-f99de5aa046e",Un="get",Jn="has",Wn="set",{isArray:pe}=Array;let{SharedArrayBuffer:ge,window:Yn}=globalThis,{notify:Pi,wait:ji,waitAsync:we}=Atomics,Mi=null;we||(we=r=>({value:new Promise(t=>{let e=new Worker("data:application/javascript,onmessage%3D(%7Bdata%3Ab%7D)%3D%3E(Atomics.wait(b%2C0)%2CpostMessage(0))");e.onmessage=t,e.postMessage(r)})}));try{new ge(4)}catch{ge=ArrayBuffer;const t=new WeakMap;if(Yn){const e=new Map,{prototype:{postMessage:s}}=Worker,i=n=>{var l;const o=(l=n.data)==null?void 0:l[ie];if(!pe(o)){n.stopImmediatePropagation();const{id:c,sb:f}=o;e.get(c)(f)}};Mi=function(n,...o){const l=n==null?void 0:n[ie];if(pe(l)){const[c,f]=l;t.set(f,c),this.addEventListener("message",i)}return s.call(this,n,...o)},we=n=>({value:new Promise(o=>{e.set(t.get(n),o)}).then(o=>{e.delete(t.get(n)),t.delete(n);for(let l=0;l<o.length;l++)n[l]=o[l];return"ok"})})}else{const e=(s,i)=>({[ie]:{id:s,sb:i}});Pi=s=>{postMessage(e(t.get(s),s))},addEventListener("message",s=>{var n;const i=(n=s.data)==null?void 0:n[ie];if(pe(i)){const[o,l]=i;t.set(l,o)}})}}/*! (c) Andrea Giammarchi - ISC */const{Int32Array:Ke,Map:yt,Uint16Array:ke}=globalThis,{BYTES_PER_ELEMENT:pt}=Ke,{BYTES_PER_ELEMENT:Gn}=ke,Hn=(r,t,e)=>{for(;ji(r,0,0,t)==="timed-out";)e()},Ve=new WeakSet,Ae=new WeakMap,Zn={value:{then:r=>r()}};let Xn=0;const nt=(r,{parse:t=JSON.parse,stringify:e=JSON.stringify,transform:s,interrupt:i}=JSON)=>{if(!Ae.has(r)){const n=Mi||r.postMessage,o=(y,...g)=>n.call(r,{[ie]:g},{transfer:y}),l=typeof i===mt?i:i==null?void 0:i.handler,c=(i==null?void 0:i.delay)||42,f=new TextDecoder("utf-16"),h=(y,g)=>y?we(g,0):(l?Hn(g,c,l):ji(g,0),Zn);let b=!1;Ae.set(r,new Proxy(new yt,{[Jn]:(y,g)=>typeof g=="string"&&!g.startsWith("_"),[Un]:(y,g)=>g==="then"?null:(...q)=>{const v=Xn++;let T=new Ke(new ge(pt*2)),Q=[];Ve.has(q.at(-1)||Q)&&Ve.delete(Q=q.pop()),o(Q,v,T,g,s?q.map(s):q);const C=r!==globalThis;let N=0;return b&&C&&(N=setTimeout(console.warn,1e3,`ðŸ’€ðŸ”’ - Possible deadlock if proxy.${g}(...args) is awaited`)),h(C,T).value.then(()=>{clearTimeout(N);const x=T[1];if(!x)return;const _=Gn*x;return T=new Ke(new ge(_+_%pt)),o([],v,T),h(C,T).value.then(()=>t(f.decode(new ke(T.buffer).slice(0,x))))})},[Wn](y,g,q){const v=typeof q;if(v!==mt)throw new Error(`Unable to assign ${g} as ${v}`);if(!y.size){const T=new yt;r.addEventListener("message",async Q=>{var N;const C=(N=Q.data)==null?void 0:N[ie];if(pe(C)){Q.stopImmediatePropagation();const[x,_,...j]=C;let S;if(j.length){const[$,B]=j;if(y.has($)){b=!0;try{const M=await y.get($)(...B);if(M!==void 0){const se=e(s?s(M):M);T.set(x,se),_[1]=se.length}}catch(M){S=M}finally{b=!1}}else S=new Error(`Unsupported action: ${$}`);_[0]=1}else{const $=T.get(x);T.delete(x);for(let B=new ke(_.buffer),M=0;M<$.length;M++)B[M]=$.charCodeAt(M)}if(Pi(_,0),S)throw S}})}return!!y.set(g,q)}}))}return Ae.get(r)};nt.transfer=(...r)=>(Ve.add(r),r);function bt(){let r,t;return{lock:async()=>{for(;r;)await r;r=new Promise(i=>{t=i})},unlock:async()=>{const i=t;r=void 0,t=void 0,i==null||i()}}}async function Ei(r,t){let e;if(r instanceof Blob?e=r.stream():e=r,e instanceof ReadableStream&&t){const i=e.getReader();switch(t){case"callback":return async()=>(await i.read()).value;case"buffer":const n=[];let o=!1;for(;!o;){const h=await i.read();h.value&&n.push(h.value),o=h.done}const l=n.reduce((h,b)=>h+b.length,0),c=new Uint8Array(l);let f=0;return n.forEach(h=>{c.set(h,f),f+=h.length}),c.buffer}}else return e}class Se{constructor(t){Object.defineProperty(this,"sqlite3InitModule",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"sqlite3",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pointers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"storageType",{enumerable:!0,configurable:!0,writable:!0,value:"memory"})}async init(t){const{databasePath:e}=t,s=this.getFlags(t);if(!this.sqlite3InitModule){const{default:i}=await Bi(async()=>{const{default:n}=await import("./D9KXvN57.js");return{default:n}},[],import.meta.url);this.sqlite3InitModule=i}this.sqlite3||(this.sqlite3=await this.sqlite3InitModule()),this.db&&await this.destroy(),this.db=new this.sqlite3.oo1.DB(e,s),this.config=t}async exec(t){if(!this.db)throw new Error("Driver not initialized");return this.execOnDb(this.db,t)}async execBatch(t){if(!this.db)throw new Error("Driver not initialized");const e=[];return this.db.transaction(s=>{for(let i of t){const n=this.execOnDb(s,i);e.push(n)}}),e}async isDatabasePersisted(){return!1}async getDatabaseSizeBytes(){var s;const t=await this.exec({sql:`SELECT page_count * page_size AS size 
				FROM pragma_page_count(), pragma_page_size()`,method:"get"}),e=(s=t==null?void 0:t.rows)==null?void 0:s[0];if(typeof e!="number")throw new Error("Failed to query database size");return e}async createFunction(t){if(!this.db)throw new Error("Driver not initialized");switch(t.type){case"callback":case"scalar":this.db.createFunction({name:t.name,xFunc:(e,...s)=>t.func(...s),arity:-1});break;case"aggregate":this.db.createFunction({name:t.name,xStep:(e,...s)=>t.func.step(...s),xFinal:(e,...s)=>t.func.final(...s),arity:-1});break}}async import(t){if(!this.sqlite3||!this.db||!this.config)throw new Error("Driver not initialized");const e=await Ei(t,"buffer"),s=this.sqlite3.wasm.allocFromTypedArray(e);this.pointers.push(s);const i=this.sqlite3.capi.sqlite3_deserialize(this.db,"main",s,e.byteLength,e.byteLength,this.config.readOnly?this.sqlite3.capi.SQLITE_DESERIALIZE_READONLY:this.sqlite3.capi.SQLITE_DESERIALIZE_RESIZEABLE);this.db.checkRc(i)}async export(){if(!this.sqlite3||!this.db)throw new Error("Driver not initialized");return{name:"database.sqlite3",data:this.sqlite3.capi.sqlite3_js_db_export(this.db)}}async clear(){}async destroy(){this.closeDb(),this.pointers.forEach(t=>{var e;return(e=this.sqlite3)==null?void 0:e.wasm.dealloc(t)}),this.pointers=[]}getFlags(t){const{readOnly:e,verbose:s}=t;return[e===!0?"r":"cw",s===!0?"t":""].join("")}execOnDb(t,e){const s={rows:[],columns:[]},i=t.exec({sql:e.sql,bind:e.params,returnValue:"resultRows",rowMode:"array",columnNames:s.columns});switch(e.method){case"run":break;case"get":s.rows=i[0]??[];break;case"all":default:s.rows=i;break}return s}closeDb(){this.db&&(this.db.close(),this.db=void 0)}}class de{constructor(t){Object.defineProperty(this,"driver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"userFunctions",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"initMutex",{enumerable:!0,configurable:!0,writable:!0,value:bt()}),Object.defineProperty(this,"transactionMutex",{enumerable:!0,configurable:!0,writable:!0,value:bt()}),Object.defineProperty(this,"transactionKey",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"proxy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reinitChannel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onmessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"init",{enumerable:!0,configurable:!0,writable:!0,value:async i=>{if(this.config.databasePath){await this.initMutex.lock();try{try{await this.driver.init(this.config)}catch{console.warn(`Persistence failed, so ${this.config.databasePath} will not be saved. For origin private file system persistence, make sure your web server is configured to use the correct HTTP response headers (See https://sqlocal.dev/guide/setup#cross-origin-isolation).`),this.config.databasePath=":memory:",this.driver=new Se,await this.driver.init(this.config)}this.driver.storageType!=="memory"&&(this.reinitChannel=new BroadcastChannel(`_sqlocal_reinit_(${this.config.databasePath})`),this.reinitChannel.onmessage=n=>{const o=n.data;if(this.config.clientKey!==o.clientKey)switch(o.type){case"reinit":this.init(o.reason);break;case"close":this.driver.destroy();break}}),await Promise.all(Array.from(this.userFunctions.values()).map(n=>this.initUserFunction(n))),await this.execInitStatements(),this.emitMessage({type:"event",event:"connect",reason:i})}catch(n){this.emitMessage({type:"error",error:n,queryKey:null}),await this.destroy()}finally{await this.initMutex.unlock()}}}}),Object.defineProperty(this,"postMessage",{enumerable:!0,configurable:!0,writable:!0,value:async(i,n)=>{const o=i instanceof MessageEvent?i.data:i;switch(await this.initMutex.lock(),o.type){case"config":this.editConfig(o);break;case"query":case"batch":case"transaction":this.exec(o);break;case"function":this.createUserFunction(o);break;case"getinfo":this.getDatabaseInfo(o);break;case"import":this.importDb(o);break;case"export":this.exportDb(o);break;case"delete":this.deleteDb(o);break;case"destroy":this.destroy(o);break}await this.initMutex.unlock()}}),Object.defineProperty(this,"emitMessage",{enumerable:!0,configurable:!0,writable:!0,value:(i,n=[])=>{this.onmessage&&this.onmessage(i,n)}}),Object.defineProperty(this,"editConfig",{enumerable:!0,configurable:!0,writable:!0,value:i=>{this.config=i.config,this.init("initial")}}),Object.defineProperty(this,"exec",{enumerable:!0,configurable:!0,writable:!0,value:async i=>{try{const n={type:"data",queryKey:i.queryKey,data:[]};switch(i.type){case"query":const o=this.transactionKey!==null&&this.transactionKey===i.transactionKey;try{o||await this.transactionMutex.lock();const l=await this.driver.exec(i);n.data.push(l)}finally{o||await this.transactionMutex.unlock()}break;case"batch":try{await this.transactionMutex.lock();const l=await this.driver.execBatch(i.statements);n.data.push(...l)}finally{await this.transactionMutex.unlock()}break;case"transaction":if(i.action==="begin"&&(await this.transactionMutex.lock(),this.transactionKey=i.transactionKey,await this.driver.exec({sql:"BEGIN"})),(i.action==="commit"||i.action==="rollback")&&this.transactionKey!==null&&this.transactionKey===i.transactionKey){const l=i.action==="commit"?"COMMIT":"ROLLBACK";await this.driver.exec({sql:l}),this.transactionKey=null,await this.transactionMutex.unlock()}break}this.emitMessage(n)}catch(n){this.emitMessage({type:"error",error:n,queryKey:i.queryKey})}}}),Object.defineProperty(this,"execInitStatements",{enumerable:!0,configurable:!0,writable:!0,value:async()=>{if(this.config.onInitStatements)for(let i of this.config.onInitStatements)await this.driver.exec(i)}}),Object.defineProperty(this,"getDatabaseInfo",{enumerable:!0,configurable:!0,writable:!0,value:async i=>{try{this.emitMessage({type:"info",queryKey:i.queryKey,info:{databasePath:this.config.databasePath,storageType:this.driver.storageType,databaseSizeBytes:await this.driver.getDatabaseSizeBytes(),persisted:await this.driver.isDatabasePersisted()}})}catch(n){this.emitMessage({type:"error",queryKey:i.queryKey,error:n})}}}),Object.defineProperty(this,"createUserFunction",{enumerable:!0,configurable:!0,writable:!0,value:async i=>{const{functionName:n,functionType:o,queryKey:l}=i;let c;if(this.userFunctions.has(n)){this.emitMessage({type:"error",error:new Error(`A user-defined function with the name "${n}" has already been created for this SQLocal instance.`),queryKey:l});return}switch(o){case"callback":c={type:o,name:n,func:(...f)=>{this.emitMessage({type:"callback",name:n,args:f})}};break;case"scalar":c={type:o,name:n,func:this.proxy[`_sqlocal_func_${n}`]};break;case"aggregate":c={type:o,name:n,func:{step:this.proxy[`_sqlocal_func_${n}_step`],final:this.proxy[`_sqlocal_func_${n}_final`]}};break}try{await this.initUserFunction(c),this.emitMessage({type:"success",queryKey:l})}catch(f){this.emitMessage({type:"error",error:f,queryKey:l})}}}),Object.defineProperty(this,"initUserFunction",{enumerable:!0,configurable:!0,writable:!0,value:async i=>{await this.driver.createFunction(i),this.userFunctions.set(i.name,i)}}),Object.defineProperty(this,"importDb",{enumerable:!0,configurable:!0,writable:!0,value:async i=>{const{queryKey:n,database:o}=i;let l=!1;try{await this.driver.import(o),this.driver.storageType==="memory"&&await this.execInitStatements()}catch(c){this.emitMessage({type:"error",error:c,queryKey:n}),l=!0}finally{this.driver.storageType!=="memory"&&await this.init("overwrite")}l||this.emitMessage({type:"success",queryKey:n})}}),Object.defineProperty(this,"exportDb",{enumerable:!0,configurable:!0,writable:!0,value:async i=>{const{queryKey:n}=i;try{const{name:o,data:l}=await this.driver.export();this.emitMessage({type:"buffer",queryKey:n,bufferName:o,buffer:l},[l])}catch(o){this.emitMessage({type:"error",error:o,queryKey:n})}}}),Object.defineProperty(this,"deleteDb",{enumerable:!0,configurable:!0,writable:!0,value:async i=>{const{queryKey:n}=i;let o=!1;try{await this.driver.clear()}catch(l){this.emitMessage({type:"error",error:l,queryKey:n}),o=!0}finally{await this.init("delete")}o||this.emitMessage({type:"success",queryKey:n})}}),Object.defineProperty(this,"destroy",{enumerable:!0,configurable:!0,writable:!0,value:async i=>{await this.driver.exec({sql:"PRAGMA optimize"}),await this.driver.destroy(),this.reinitChannel&&(this.reinitChannel.close(),this.reinitChannel=void 0),i&&this.emitMessage({type:"success",queryKey:i.queryKey})}});const s=typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope?nt(globalThis):globalThis;this.proxy=s,this.driver=t}}function ve(r,...t){return{sql:r.join("?"),params:t}}function ea(r){return!r.some(t=>!Array.isArray(t))}function De(r,t){let e;return ea(r)?e=r:e=[r],e.map(s=>{const i={};return t.forEach((n,o)=>{i[n]=s[o]}),i})}function ta(r){return typeof r=="object"&&r!==null&&"getSQL"in r&&typeof r.getSQL=="function"}function sa(r){return typeof r=="object"&&r!==null&&"sql"in r&&typeof r.sql=="string"&&"params"in r}function ra(r){if(typeof r=="function"&&(r=r(ve)),ta(r))try{if(!("toSQL"in r&&typeof r.toSQL=="function"))throw 1;const s=r.toSQL();if(!sa(s))throw 2;return s}catch{throw new Error("The passed statement could not be parsed.")}const t=r.sql;let e=[];return"params"in r?e=r.params:"parameters"in r&&(e=r.parameters),{sql:t,params:e}}function Ie(){return crypto.randomUUID()}function gt(r,t){let e;return typeof r=="string"?e={sql:r,params:t}:e=ve(r,...t),e}async function me(r,t,e,s){return!t&&"locks"in navigator?navigator.locks.request(`_sqlocal_mutation_(${e.databasePath})`,{mode:r},s):s()}class wt extends Se{constructor(t,e){super(e),Object.defineProperty(this,"storageType",{enumerable:!0,configurable:!0,writable:!0,value:t})}async init(t){const e=this.getFlags(t);if(t.readOnly)throw new Error(`SQLite storage type "${this.storageType}" does not support read-only mode.`);if(!this.sqlite3InitModule){const{default:s}=await Bi(async()=>{const{default:i}=await import("./D9KXvN57.js");return{default:i}},[],import.meta.url);this.sqlite3InitModule=s}this.sqlite3||(this.sqlite3=await this.sqlite3InitModule()),this.db&&await this.destroy(),this.db=new this.sqlite3.oo1.JsStorageDb({filename:this.storageType,flags:e}),this.config=t}async isDatabasePersisted(){var t;return(t=navigator.storage)==null?void 0:t.persisted()}async getDatabaseSizeBytes(){if(!this.db)throw new Error("Driver not initialized");return this.db.storageSize()}async import(t){const e=new Se;await e.init({}),await e.import(t),await this.clear(),await e.exec({sql:`VACUUM INTO 'file:${this.storageType}?vfs=kvvfs'`}),await e.destroy()}async clear(){if(!this.db)throw new Error("Driver not initialized");this.db.clearStorage()}async destroy(){this.closeDb()}}class ia{constructor(t){Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"processor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDestroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"bypassMutationLock",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"userCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"queriesInProgress",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"proxy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reinitChannel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"processMessageEvent",{enumerable:!0,configurable:!0,writable:!0,value:c=>{var b,y;const f=c instanceof MessageEvent?c.data:c,h=this.queriesInProgress;switch(f.type){case"success":case"data":case"buffer":case"info":case"error":if(f.queryKey&&h.has(f.queryKey)){const[q,v]=h.get(f.queryKey);f.type==="error"?v(f.error):q(f),h.delete(f.queryKey)}else if(f.type==="error")throw f.error;break;case"callback":const g=this.userCallbacks.get(f.name);g&&g(...f.args??[]);break;case"event":(y=(b=this.config).onConnect)==null||y.call(b,f.reason);break}}}),Object.defineProperty(this,"createQuery",{enumerable:!0,configurable:!0,writable:!0,value:async c=>me("shared",this.bypassMutationLock||c.type==="import"||c.type==="delete",this.config,async()=>{if(this.isDestroyed===!0)throw new Error("This SQLocal client has been destroyed. You will need to initialize a new client in order to make further queries.");const f=Ie();switch(c.type){case"import":this.processor.postMessage({...c,queryKey:f},[c.database]);break;default:this.processor.postMessage({...c,queryKey:f});break}return new Promise((h,b)=>{this.queriesInProgress.set(f,[h,b])})})}),Object.defineProperty(this,"broadcast",{enumerable:!0,configurable:!0,writable:!0,value:c=>{this.reinitChannel.postMessage(c)}}),Object.defineProperty(this,"exec",{enumerable:!0,configurable:!0,writable:!0,value:async(c,f,h="all",b)=>{var q,v;const y=await this.createQuery({type:"query",transactionKey:b,sql:c,params:f,method:h}),g={rows:[],columns:[]};return y.type==="data"&&(g.rows=((q=y.data[0])==null?void 0:q.rows)??[],g.columns=((v=y.data[0])==null?void 0:v.columns)??[]),g}}),Object.defineProperty(this,"execBatch",{enumerable:!0,configurable:!0,writable:!0,value:async c=>{const f=await this.createQuery({type:"batch",statements:c}),h=new Array(c.length).fill({rows:[],columns:[]});return f.type==="data"&&f.data.forEach((b,y)=>{h[y]=b}),h}}),Object.defineProperty(this,"sql",{enumerable:!0,configurable:!0,writable:!0,value:async(c,...f)=>{const h=gt(c,f),{rows:b,columns:y}=await this.exec(h.sql,h.params,"all");return De(b,y)}}),Object.defineProperty(this,"batch",{enumerable:!0,configurable:!0,writable:!0,value:async c=>{const f=c(ve);return(await this.execBatch(f)).map(({rows:b,columns:y})=>De(b,y))}}),Object.defineProperty(this,"beginTransaction",{enumerable:!0,configurable:!0,writable:!0,value:async()=>{const c=Ie();await this.createQuery({type:"transaction",transactionKey:c,action:"begin"});const f=async g=>{const q=ra(g),{rows:v,columns:T}=await this.exec(q.sql,q.params,"all",c);return De(v,T)};return{query:f,sql:async(g,...q)=>{const v=gt(g,q);return await f(v)},commit:async()=>{await this.createQuery({type:"transaction",transactionKey:c,action:"commit"})},rollback:async()=>{await this.createQuery({type:"transaction",transactionKey:c,action:"rollback"})}}}}),Object.defineProperty(this,"transaction",{enumerable:!0,configurable:!0,writable:!0,value:async c=>me("exclusive",!1,this.config,async()=>{let f;this.bypassMutationLock=!0;try{f=await this.beginTransaction();const h=await c({sql:f.sql,query:f.query});return await f.commit(),h}catch(h){throw await(f==null?void 0:f.rollback()),h}finally{this.bypassMutationLock=!1}})}),Object.defineProperty(this,"createCallbackFunction",{enumerable:!0,configurable:!0,writable:!0,value:async(c,f)=>{await this.createQuery({type:"function",functionName:c,functionType:"callback"}),this.userCallbacks.set(c,f)}}),Object.defineProperty(this,"createScalarFunction",{enumerable:!0,configurable:!0,writable:!0,value:async(c,f)=>{const h=`_sqlocal_func_${c}`,b=()=>{this.proxy[h]=f};this.proxy===globalThis&&b(),await this.createQuery({type:"function",functionName:c,functionType:"scalar"}),this.proxy!==globalThis&&b()}}),Object.defineProperty(this,"createAggregateFunction",{enumerable:!0,configurable:!0,writable:!0,value:async(c,f)=>{const h=`_sqlocal_func_${c}`,b=()=>{this.proxy[`${h}_step`]=f.step,this.proxy[`${h}_final`]=f.final};this.proxy===globalThis&&b(),await this.createQuery({type:"function",functionName:c,functionType:"aggregate"}),this.proxy!==globalThis&&b()}}),Object.defineProperty(this,"getDatabaseInfo",{enumerable:!0,configurable:!0,writable:!0,value:async()=>{const c=await this.createQuery({type:"getinfo"});if(c.type==="info")return c.info;throw new Error("The database failed to return valid information.")}}),Object.defineProperty(this,"getDatabaseFile",{enumerable:!0,configurable:!0,writable:!0,value:async()=>{const c=await this.createQuery({type:"export"});if(c.type==="buffer")return new File([c.buffer],c.bufferName,{type:"application/x-sqlite3"});throw new Error("The database failed to export.")}}),Object.defineProperty(this,"overwriteDatabaseFile",{enumerable:!0,configurable:!0,writable:!0,value:async(c,f)=>{await me("exclusive",!1,this.config,async()=>{try{this.broadcast({type:"close",clientKey:this.clientKey});const h=await Ei(c,"buffer");await this.createQuery({type:"import",database:h}),typeof f=="function"&&(this.bypassMutationLock=!0,await f()),this.broadcast({type:"reinit",clientKey:this.clientKey,reason:"overwrite"})}finally{this.bypassMutationLock=!1}})}}),Object.defineProperty(this,"deleteDatabaseFile",{enumerable:!0,configurable:!0,writable:!0,value:async c=>{await me("exclusive",!1,this.config,async()=>{try{this.broadcast({type:"close",clientKey:this.clientKey}),await this.createQuery({type:"delete"}),typeof c=="function"&&(this.bypassMutationLock=!0,await c()),this.broadcast({type:"reinit",clientKey:this.clientKey,reason:"delete"})}finally{this.bypassMutationLock=!1}})}}),Object.defineProperty(this,"destroy",{enumerable:!0,configurable:!0,writable:!0,value:async()=>{await this.createQuery({type:"destroy"}),typeof globalThis.Worker<"u"&&this.processor instanceof Worker&&(this.processor.removeEventListener("message",this.processMessageEvent),this.processor.terminate()),this.queriesInProgress.clear(),this.userCallbacks.clear(),this.reinitChannel.close(),this.isDestroyed=!0}});const e=typeof t=="string"?{databasePath:t}:t,{onInit:s,onConnect:i,processor:n,...o}=e,{databasePath:l}=o;if(this.config=e,this.clientKey=Ie(),this.reinitChannel=new BroadcastChannel(`_sqlocal_reinit_(${l})`),typeof n<"u")this.processor=n;else if(l==="local"||l===":localStorage:"){const c=new wt("local");this.processor=new de(c)}else if(l==="session"||l===":sessionStorage:"){const c=new wt("session");this.processor=new de(c)}else if(typeof globalThis.Worker<"u"&&l!==":memory:")this.processor=new Worker(new URL(""+new URL("../workers/worker-Bb9xjQ-D.js",import.meta.url).href,import.meta.url),{type:"module"});else{const c=new Se;this.processor=new de(c)}this.processor instanceof de?(this.processor.onmessage=c=>this.processMessageEvent(c),this.proxy=globalThis):(this.processor.addEventListener("message",this.processMessageEvent),this.proxy=nt(this.processor)),this.processor.postMessage({type:"config",config:{...o,clientKey:this.clientKey,onInitStatements:(s==null?void 0:s(ve))??[]}})}}class no extends ia{constructor(){super(...arguments),Object.defineProperty(this,"driver",{enumerable:!0,configurable:!0,writable:!0,value:async(t,e,s)=>(/^begin\b/i.test(t)&&typeof globalThis.sessionStorage<"u"&&!sessionStorage._sqlocal_sent_drizzle_transaction_warning&&(console.warn("Drizzle's transaction method cannot isolate transactions from outside queries. It is recommended to use the transaction method of SQLocalDrizzle instead (See https://sqlocal.dev/api/transaction#drizzle)."),sessionStorage._sqlocal_sent_drizzle_transaction_warning="1"),this.exec(t,e,s))}),Object.defineProperty(this,"batchDriver",{enumerable:!0,configurable:!0,writable:!0,value:async t=>this.execBatch(t)})}}const m=Symbol.for("drizzle:entityKind");function d(r,t){if(!r||typeof r!="object")return!1;if(r instanceof t)return!0;if(!Object.prototype.hasOwnProperty.call(t,m))throw new Error(`Class "${t.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let e=Object.getPrototypeOf(r).constructor;if(e)for(;e;){if(m in e&&e[m]===t[m])return!0;e=Object.getPrototypeOf(e)}return!1}var Nt;Nt=m;class Ai{write(t){console.log(t)}}a(Ai,Nt,"ConsoleLogWriter");var Ct;Ct=m;class Di{constructor(t){a(this,"writer");this.writer=(t==null?void 0:t.writer)??new Ai}logQuery(t,e){const s=e.map(n=>{try{return JSON.stringify(n)}catch{return String(n)}}),i=s.length?` -- params: [${s.join(", ")}]`:"";this.writer.write(`Query: ${t}${i}`)}}a(Di,Ct,"DefaultLogger");var Lt;Lt=m;class Ii{logQuery(){}}a(Ii,Lt,"NoopLogger");const W=Symbol.for("drizzle:Name"),be=Symbol.for("drizzle:Schema"),Ue=Symbol.for("drizzle:Columns"),St=Symbol.for("drizzle:ExtraConfigColumns"),Re=Symbol.for("drizzle:OriginalName"),Fe=Symbol.for("drizzle:BaseName"),qe=Symbol.for("drizzle:IsAlias"),vt=Symbol.for("drizzle:ExtraConfigBuilder"),na=Symbol.for("drizzle:IsDrizzleTable");var Ot,_t,Bt,Pt,jt,Mt,Et,At,Dt,It;It=m,Dt=W,At=Re,Et=be,Mt=Ue,jt=St,Pt=Fe,Bt=qe,_t=na,Ot=vt;class p{constructor(t,e,s){a(this,Dt);a(this,At);a(this,Et);a(this,Mt);a(this,jt);a(this,Pt);a(this,Bt,!1);a(this,_t,!0);a(this,Ot);this[W]=this[Re]=t,this[be]=e,this[Fe]=s}}a(p,It,"Table"),a(p,"Symbol",{Name:W,Schema:be,OriginalName:Re,Columns:Ue,ExtraConfigColumns:St,BaseName:Fe,IsAlias:qe,ExtraConfigBuilder:vt});function ne(r){return r[W]}function le(r){return`${r[be]??"public"}.${r[W]}`}var Rt;Rt=m;class L{constructor(t,e){a(this,"name");a(this,"keyAsName");a(this,"primary");a(this,"notNull");a(this,"default");a(this,"defaultFn");a(this,"onUpdateFn");a(this,"hasDefault");a(this,"isUnique");a(this,"uniqueName");a(this,"uniqueType");a(this,"dataType");a(this,"columnType");a(this,"enumValues");a(this,"generated");a(this,"generatedIdentity");a(this,"config");this.table=t,this.config=e,this.name=e.name,this.keyAsName=e.keyAsName,this.notNull=e.notNull,this.default=e.default,this.defaultFn=e.defaultFn,this.onUpdateFn=e.onUpdateFn,this.hasDefault=e.hasDefault,this.primary=e.primaryKey,this.isUnique=e.isUnique,this.uniqueName=e.uniqueName,this.uniqueType=e.uniqueType,this.dataType=e.dataType,this.columnType=e.columnType,this.generated=e.generated,this.generatedIdentity=e.generatedIdentity}mapFromDriverValue(t){return t}mapToDriverValue(t){return t}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}a(L,Rt,"Column");var Ft;Ft=m;class Ri{constructor(t,e,s){a(this,"config");a(this,"$default",this.$defaultFn);a(this,"$onUpdate",this.$onUpdateFn);this.config={name:t,keyAsName:t==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:e,columnType:s,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(t){return this.config.default=t,this.config.hasDefault=!0,this}$defaultFn(t){return this.config.defaultFn=t,this.config.hasDefault=!0,this}$onUpdateFn(t){return this.config.onUpdateFn=t,this.config.hasDefault=!0,this}primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(t){this.config.name===""&&(this.config.name=t)}}a(Ri,Ft,"ColumnBuilder");const qt=Symbol.for("drizzle:isPgEnum");function aa(r){return!!r&&typeof r=="function"&&qt in r&&r[qt]===!0}var zt;zt=m;class R{constructor(t,e,s,i=!1,n=[]){this._={brand:"Subquery",sql:t,selectedFields:e,alias:s,isWith:i,usedTables:n}}}a(R,zt,"Subquery");var Kt,kt;class at extends(kt=R,Kt=m,kt){}a(at,Kt,"WithSubquery");const oa={startActiveSpan(r,t){return t()}},P=Symbol.for("drizzle:ViewBaseConfig");function Fi(r){return r!=null&&typeof r.getSQL=="function"}function la(r){var e;const t={sql:"",params:[]};for(const s of r)t.sql+=s.sql,t.params.push(...s.params),(e=s.typings)!=null&&e.length&&(t.typings||(t.typings=[]),t.typings.push(...s.typings));return t}var Vt;Vt=m;class O{constructor(t){a(this,"value");this.value=Array.isArray(t)?t:[t]}getSQL(){return new w([this])}}a(O,Vt,"StringChunk");var Ut;Ut=m;const G=class G{constructor(t){a(this,"decoder",zi);a(this,"shouldInlineParams",!1);a(this,"usedTables",[]);this.queryChunks=t;for(const e of t)if(d(e,p)){const s=e[p.Symbol.Schema];this.usedTables.push(s===void 0?e[p.Symbol.Name]:s+"."+e[p.Symbol.Name])}}append(t){return this.queryChunks.push(...t.queryChunks),this}toQuery(t){return oa.startActiveSpan("drizzle.buildSQL",e=>{const s=this.buildQueryFromSourceParams(this.queryChunks,t);return e==null||e.setAttributes({"drizzle.query.text":s.sql,"drizzle.query.params":JSON.stringify(s.params)}),s})}buildQueryFromSourceParams(t,e){const s=Object.assign({},e,{inlineParams:e.inlineParams||this.shouldInlineParams,paramStartIndex:e.paramStartIndex||{value:0}}),{casing:i,escapeName:n,escapeParam:o,prepareTyping:l,inlineParams:c,paramStartIndex:f}=s;return la(t.map(h=>{var b;if(d(h,O))return{sql:h.value.join(""),params:[]};if(d(h,Te))return{sql:n(h.value),params:[]};if(h===void 0)return{sql:"",params:[]};if(Array.isArray(h)){const y=[new O("(")];for(const[g,q]of h.entries())y.push(q),g<h.length-1&&y.push(new O(", "));return y.push(new O(")")),this.buildQueryFromSourceParams(y,s)}if(d(h,G))return this.buildQueryFromSourceParams(h.queryChunks,{...s,inlineParams:c||h.shouldInlineParams});if(d(h,p)){const y=h[p.Symbol.Schema],g=h[p.Symbol.Name];return{sql:y===void 0||h[qe]?n(g):n(y)+"."+n(g),params:[]}}if(d(h,L)){const y=i.getColumnCasing(h);if(e.invokeSource==="indexes")return{sql:n(y),params:[]};const g=h.table[p.Symbol.Schema];return{sql:h.table[qe]||g===void 0?n(h.table[p.Symbol.Name])+"."+n(y):n(g)+"."+n(h.table[p.Symbol.Name])+"."+n(y),params:[]}}if(d(h,te)){const y=h[P].schema,g=h[P].name;return{sql:y===void 0||h[P].isAlias?n(g):n(y)+"."+n(g),params:[]}}if(d(h,U)){if(d(h.value,Z))return{sql:o(f.value++,h),params:[h],typings:["none"]};const y=h.value===null?null:h.encoder.mapToDriverValue(h.value);if(d(y,G))return this.buildQueryFromSourceParams([y],s);if(c)return{sql:this.mapInlineParam(y,s),params:[]};let g=["none"];return l&&(g=[l(h.encoder)]),{sql:o(f.value++,y),params:[y],typings:g}}return d(h,Z)?{sql:o(f.value++,h),params:[h],typings:["none"]}:d(h,G.Aliased)&&h.fieldAlias!==void 0?{sql:n(h.fieldAlias),params:[]}:d(h,R)?h._.isWith?{sql:n(h._.alias),params:[]}:this.buildQueryFromSourceParams([new O("("),h._.sql,new O(") "),new Te(h._.alias)],s):aa(h)?h.schema?{sql:n(h.schema)+"."+n(h.enumName),params:[]}:{sql:n(h.enumName),params:[]}:Fi(h)?(b=h.shouldOmitSQLParens)!=null&&b.call(h)?this.buildQueryFromSourceParams([h.getSQL()],s):this.buildQueryFromSourceParams([new O("("),h.getSQL(),new O(")")],s):c?{sql:this.mapInlineParam(h,s),params:[]}:{sql:o(f.value++,h),params:[h],typings:["none"]}}))}mapInlineParam(t,{escapeString:e}){if(t===null)return"null";if(typeof t=="number"||typeof t=="boolean")return t.toString();if(typeof t=="string")return e(t);if(typeof t=="object"){const s=t.toString();return e(s==="[object Object]"?JSON.stringify(t):s)}throw new Error("Unexpected param value: "+t)}getSQL(){return this}as(t){return t===void 0?this:new G.Aliased(this,t)}mapWith(t){return this.decoder=typeof t=="function"?{mapFromDriverValue:t}:t,this}inlineParams(){return this.shouldInlineParams=!0,this}if(t){return t?this:void 0}};a(G,Ut,"SQL");let w=G;var Jt;Jt=m;class Te{constructor(t){a(this,"brand");this.value=t}getSQL(){return new w([this])}}a(Te,Jt,"Name");function ca(r){return typeof r=="object"&&r!==null&&"mapToDriverValue"in r&&typeof r.mapToDriverValue=="function"}const zi={mapFromDriverValue:r=>r},Ki={mapToDriverValue:r=>r};({...zi,...Ki});var Wt;Wt=m;class U{constructor(t,e=Ki){a(this,"brand");this.value=t,this.encoder=e}getSQL(){return new w([this])}}a(U,Wt,"Param");function u(r,...t){const e=[];(t.length>0||r.length>0&&r[0]!=="")&&e.push(new O(r[0]));for(const[s,i]of t.entries())e.push(i,new O(r[s+1]));return new w(e)}(r=>{function t(){return new w([])}r.empty=t;function e(c){return new w(c)}r.fromList=e;function s(c){return new w([new O(c)])}r.raw=s;function i(c,f){const h=[];for(const[b,y]of c.entries())b>0&&f!==void 0&&h.push(f),h.push(y);return new w(h)}r.join=i;function n(c){return new Te(c)}r.identifier=n;function o(c){return new Z(c)}r.placeholder=o;function l(c,f){return new U(c,f)}r.param=l})(u||(u={}));(r=>{var e;e=m;const s=class s{constructor(n,o){a(this,"isSelectionField",!1);this.sql=n,this.fieldAlias=o}getSQL(){return this.sql}clone(){return new s(this.sql,this.fieldAlias)}};a(s,e,"SQL.Aliased");let t=s;r.Aliased=t})(w||(w={}));var Yt;Yt=m;class Z{constructor(t){this.name=t}getSQL(){return new w([this])}}a(Z,Yt,"Placeholder");function ye(r,t){return r.map(e=>{if(d(e,Z)){if(!(e.name in t))throw new Error(`No value for placeholder "${e.name}" was provided`);return t[e.name]}if(d(e,U)&&d(e.value,Z)){if(!(e.value.name in t))throw new Error(`No value for placeholder "${e.value.name}" was provided`);return e.encoder.mapToDriverValue(t[e.value.name])}return e})}const ua=Symbol.for("drizzle:IsDrizzleView");var Gt,Ht,Zt;Zt=m,Ht=P,Gt=ua;class te{constructor({name:t,schema:e,selectedFields:s,query:i}){a(this,Ht);a(this,Gt,!0);this[P]={name:t,originalName:t,schema:e,selectedFields:s,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new w([this])}}a(te,Zt,"View");L.prototype.getSQL=function(){return new w([this])};p.prototype.getSQL=function(){return new w([this])};R.prototype.getSQL=function(){return new w([this])};function Tt(r,t,e){const s={},i=r.reduce((n,{path:o,field:l},c)=>{let f;d(l,L)?f=l:d(l,w)?f=l.decoder:f=l.sql.decoder;let h=n;for(const[b,y]of o.entries())if(b<o.length-1)y in h||(h[y]={}),h=h[y];else{const g=t[c],q=h[y]=g===null?null:f.mapFromDriverValue(g);if(e&&d(l,L)&&o.length===2){const v=o[0];v in s?typeof s[v]=="string"&&s[v]!==ne(l.table)&&(s[v]=!1):s[v]=q===null?ne(l.table):!1}}return n},{});if(e&&Object.keys(s).length>0)for(const[n,o]of Object.entries(s))typeof o=="string"&&!e[o]&&(i[n]=null);return i}function X(r,t){return Object.entries(r).reduce((e,[s,i])=>{if(typeof s!="string")return e;const n=t?[...t,s]:[s];return d(i,L)||d(i,w)||d(i,w.Aliased)?e.push({path:n,field:i}):d(i,p)?e.push(...X(i[p.Symbol.Columns],n)):e.push(...X(i,n)),e},[])}function ot(r,t){const e=Object.keys(r),s=Object.keys(t);if(e.length!==s.length)return!1;for(const[i,n]of e.entries())if(n!==s[i])return!1;return!0}function ki(r,t){const e=Object.entries(t).filter(([,s])=>s!==void 0).map(([s,i])=>d(i,w)||d(i,L)?[s,i]:[s,new U(i,r[p.Symbol.Columns][s])]);if(e.length===0)throw new Error("No values to set");return Object.fromEntries(e)}function ha(r,t){for(const e of t)for(const s of Object.getOwnPropertyNames(e.prototype))s!=="constructor"&&Object.defineProperty(r.prototype,s,Object.getOwnPropertyDescriptor(e.prototype,s)||Object.create(null))}function fa(r){return r[p.Symbol.Columns]}function Je(r){return d(r,R)?r._.alias:d(r,te)?r[P].name:d(r,w)?void 0:r[p.Symbol.IsAlias]?r[p.Symbol.Name]:r[p.Symbol.BaseName]}function he(r,t){return{name:typeof r=="string"&&r.length>0?r:"",config:typeof r=="object"?r:t}}const xt=Symbol.for("drizzle:PgInlineForeignKeys"),$t=Symbol.for("drizzle:EnableRLS");var Xt,es,ts,ss,rs,is;class We extends(is=p,rs=m,ss=xt,ts=$t,es=p.Symbol.ExtraConfigBuilder,Xt=p.Symbol.ExtraConfigColumns,is){constructor(){super(...arguments);a(this,ss,[]);a(this,ts,!1);a(this,es);a(this,Xt,{})}}a(We,rs,"PgTable"),a(We,"Symbol",Object.assign({},p.Symbol,{InlineForeignKeys:xt,EnableRLS:$t}));var ns;ns=m;class Vi{constructor(t,e){a(this,"columns");a(this,"name");this.columns=t,this.name=e}build(t){return new Ui(t,this.columns,this.name)}}a(Vi,ns,"PgPrimaryKeyBuilder");var as;as=m;class Ui{constructor(t,e,s){a(this,"columns");a(this,"name");this.table=t,this.columns=e,this.name=s}getName(){return this.name??`${this.table[We.Symbol.Name]}_${this.columns.map(t=>t.name).join("_")}_pk`}}a(Ui,as,"PgPrimaryKey");function I(r,t){return ca(t)&&!Fi(r)&&!d(r,U)&&!d(r,Z)&&!d(r,L)&&!d(r,p)&&!d(r,te)?new U(r,t):r}const Ji=(r,t)=>u`${r} = ${I(t,r)}`,da=(r,t)=>u`${r} <> ${I(t,r)}`;function Ye(...r){const t=r.filter(e=>e!==void 0);if(t.length!==0)return t.length===1?new w(t):new w([new O("("),u.join(t,new O(" and ")),new O(")")])}function ma(...r){const t=r.filter(e=>e!==void 0);if(t.length!==0)return t.length===1?new w(t):new w([new O("("),u.join(t,new O(" or ")),new O(")")])}function ya(r){return u`not ${r}`}const pa=(r,t)=>u`${r} > ${I(t,r)}`,ba=(r,t)=>u`${r} >= ${I(t,r)}`,ga=(r,t)=>u`${r} < ${I(t,r)}`,wa=(r,t)=>u`${r} <= ${I(t,r)}`;function Sa(r,t){return Array.isArray(t)?t.length===0?u`false`:u`${r} in ${t.map(e=>I(e,r))}`:u`${r} in ${I(t,r)}`}function va(r,t){return Array.isArray(t)?t.length===0?u`true`:u`${r} not in ${t.map(e=>I(e,r))}`:u`${r} not in ${I(t,r)}`}function qa(r){return u`${r} is null`}function Ta(r){return u`${r} is not null`}function xa(r){return u`exists ${r}`}function $a(r){return u`not exists ${r}`}function Qa(r,t,e){return u`${r} between ${I(t,r)} and ${I(e,r)}`}function Na(r,t,e){return u`${r} not between ${I(t,r)} and ${I(e,r)}`}function Ca(r,t){return u`${r} like ${t}`}function La(r,t){return u`${r} not like ${t}`}function Oa(r,t){return u`${r} ilike ${t}`}function _a(r,t){return u`${r} not ilike ${t}`}function Ba(r){return u`${r} asc`}function Pa(r){return u`${r} desc`}var os;os=m;class lt{constructor(t,e,s){a(this,"referencedTableName");a(this,"fieldName");this.sourceTable=t,this.referencedTable=e,this.relationName=s,this.referencedTableName=e[p.Symbol.Name]}}a(lt,os,"Relation");var ls;ls=m;class Wi{constructor(t,e){this.table=t,this.config=e}}a(Wi,ls,"Relations");var cs,us;const Ne=class Ne extends(us=lt,cs=m,us){constructor(t,e,s,i){super(t,e,s==null?void 0:s.relationName),this.config=s,this.isNullable=i}withFieldName(t){const e=new Ne(this.sourceTable,this.referencedTable,this.config,this.isNullable);return e.fieldName=t,e}};a(Ne,cs,"One");let ee=Ne;var hs,fs;const Ce=class Ce extends(fs=lt,hs=m,fs){constructor(t,e,s){super(t,e,s==null?void 0:s.relationName),this.config=s}withFieldName(t){const e=new Ce(this.sourceTable,this.referencedTable,this.config);return e.fieldName=t,e}};a(Ce,hs,"Many");let xe=Ce;function ja(){return{and:Ye,between:Qa,eq:Ji,exists:xa,gt:pa,gte:ba,ilike:Oa,inArray:Sa,isNull:qa,isNotNull:Ta,like:Ca,lt:ga,lte:wa,ne:da,not:ya,notBetween:Na,notExists:$a,notLike:La,notIlike:_a,notInArray:va,or:ma,sql:u}}function Ma(){return{sql:u,asc:Ba,desc:Pa}}function Ea(r,t){var n;Object.keys(r).length===1&&"default"in r&&!d(r.default,p)&&(r=r.default);const e={},s={},i={};for(const[o,l]of Object.entries(r))if(d(l,p)){const c=le(l),f=s[c];e[c]=o,i[o]={tsName:o,dbName:l[p.Symbol.Name],schema:l[p.Symbol.Schema],columns:l[p.Symbol.Columns],relations:(f==null?void 0:f.relations)??{},primaryKey:(f==null?void 0:f.primaryKey)??[]};for(const b of Object.values(l[p.Symbol.Columns]))b.primary&&i[o].primaryKey.push(b);const h=(n=l[p.Symbol.ExtraConfigBuilder])==null?void 0:n.call(l,l[p.Symbol.ExtraConfigColumns]);if(h)for(const b of Object.values(h))d(b,Vi)&&i[o].primaryKey.push(...b.columns)}else if(d(l,Wi)){const c=le(l.table),f=e[c],h=l.config(t(l.table));let b;for(const[y,g]of Object.entries(h))if(f){const q=i[f];q.relations[y]=g}else c in s||(s[c]={relations:{},primaryKey:b}),s[c].relations[y]=g}return{tables:i,tableNamesMap:e}}function Aa(r){return function(e,s){return new ee(r,e,s,(s==null?void 0:s.fields.reduce((i,n)=>i&&n.notNull,!0))??!1)}}function Da(r){return function(e,s){return new xe(r,e,s)}}function Ia(r,t,e){if(d(e,ee)&&e.config)return{fields:e.config.fields,references:e.config.references};const s=t[le(e.referencedTable)];if(!s)throw new Error(`Table "${e.referencedTable[p.Symbol.Name]}" not found in schema`);const i=r[s];if(!i)throw new Error(`Table "${s}" not found in schema`);const n=e.sourceTable,o=t[le(n)];if(!o)throw new Error(`Table "${n[p.Symbol.Name]}" not found in schema`);const l=[];for(const c of Object.values(i.relations))(e.relationName&&e!==c&&c.relationName===e.relationName||!e.relationName&&c.referencedTable===e.sourceTable)&&l.push(c);if(l.length>1)throw e.relationName?new Error(`There are multiple relations with name "${e.relationName}" in table "${s}"`):new Error(`There are multiple relations between "${s}" and "${e.sourceTable[p.Symbol.Name]}". Please specify relation name`);if(l[0]&&d(l[0],ee)&&l[0].config)return{fields:l[0].config.references,references:l[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${e.fieldName}"`)}function Ra(r){return{one:Aa(r),many:Da(r)}}function Ge(r,t,e,s,i=n=>n){const n={};for(const[o,l]of s.entries())if(l.isJson){const c=t.relations[l.tsKey],f=e[o],h=typeof f=="string"?JSON.parse(f):f;n[l.tsKey]=d(c,ee)?h&&Ge(r,r[l.relationTableTsKey],h,l.selection,i):h.map(b=>Ge(r,r[l.relationTableTsKey],b,l.selection,i))}else{const c=i(e[o]),f=l.field;let h;d(f,L)?h=f:d(f,w)?h=f.decoder:h=f.sql.decoder,n[l.tsKey]=c===null?null:h.mapFromDriverValue(c)}return n}var ds;ds=m;class ce{constructor(t){this.table=t}get(t,e){return e==="table"?this.table:t[e]}}a(ce,ds,"ColumnAliasProxyHandler");var ms;ms=m;class _e{constructor(t,e){this.alias=t,this.replaceOriginalName=e}get(t,e){if(e===p.Symbol.IsAlias)return!0;if(e===p.Symbol.Name)return this.alias;if(this.replaceOriginalName&&e===p.Symbol.OriginalName)return this.alias;if(e===P)return{...t[P],name:this.alias,isAlias:!0};if(e===p.Symbol.Columns){const i=t[p.Symbol.Columns];if(!i)return i;const n={};return Object.keys(i).map(o=>{n[o]=new Proxy(i[o],new ce(new Proxy(t,this)))}),n}const s=t[e];return d(s,L)?new Proxy(s,new ce(new Proxy(t,this))):s}}a(_e,ms,"TableAliasProxyHandler");function ze(r,t){return new Proxy(r,new _e(t,!1))}function k(r,t){return new Proxy(r,new ce(new Proxy(r.table,new _e(t,!1))))}function Yi(r,t){return new w.Aliased($e(r.sql,t),r.fieldAlias)}function $e(r,t){return u.join(r.queryChunks.map(e=>d(e,L)?k(e,t):d(e,w)?$e(e,t):d(e,w.Aliased)?Yi(e,t):e))}var ys;ys=m;const Le=class Le{constructor(t){a(this,"config");this.config={...t}}get(t,e){if(e==="_")return{...t._,selectedFields:new Proxy(t._.selectedFields,this)};if(e===P)return{...t[P],selectedFields:new Proxy(t[P].selectedFields,this)};if(typeof e=="symbol")return t[e];const i=(d(t,R)?t._.selectedFields:d(t,te)?t[P].selectedFields:t)[e];if(d(i,w.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;const n=i.clone();return n.isSelectionField=!0,n}if(d(i,w)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${e}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return d(i,L)?this.config.alias?new Proxy(i,new ce(new Proxy(i.table,new _e(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new Le(this.config))}};a(Le,ys,"SelectionProxyHandler");let E=Le;var ps,bs;bs=m,ps=Symbol.toStringTag;class Y{constructor(){a(this,ps,"QueryPromise")}catch(t){return this.then(void 0,t)}finally(t){return this.then(e=>(t==null||t(),e),e=>{throw t==null||t(),e})}then(t,e){return this.execute().then(t,e)}}a(Y,bs,"QueryPromise");var gs;gs=m;class ct{constructor(t,e){a(this,"reference");a(this,"_onUpdate");a(this,"_onDelete");this.reference=()=>{const{name:s,columns:i,foreignColumns:n}=t();return{name:s,columns:i,foreignTable:n[0].table,foreignColumns:n}},e&&(this._onUpdate=e.onUpdate,this._onDelete=e.onDelete)}onUpdate(t){return this._onUpdate=t,this}onDelete(t){return this._onDelete=t,this}build(t){return new Gi(t,this)}}a(ct,gs,"SQLiteForeignKeyBuilder");var ws;ws=m;class Gi{constructor(t,e){a(this,"reference");a(this,"onUpdate");a(this,"onDelete");this.table=t,this.reference=e.reference,this.onUpdate=e._onUpdate,this.onDelete=e._onDelete}getName(){const{name:t,columns:e,foreignColumns:s}=this.reference(),i=e.map(l=>l.name),n=s.map(l=>l.name),o=[this.table[W],...i,s[0].table[W],...n];return t??`${o.join("_")}_fk`}}a(Gi,ws,"SQLiteForeignKey");function ao(r){function t(){if(typeof r=="function"){const{name:e,columns:s,foreignColumns:i}=r();return{name:e,columns:s,foreignColumns:i}}return r}return new ct(t)}function Fa(r,t){return`${r[W]}_${t.join("_")}_unique`}var Ss,vs;class F extends(vs=Ri,Ss=m,vs){constructor(){super(...arguments);a(this,"foreignKeyConfigs",[])}references(e,s={}){return this.foreignKeyConfigs.push({ref:e,actions:s}),this}unique(e){return this.config.isUnique=!0,this.config.uniqueName=e,this}generatedAlwaysAs(e,s){return this.config.generated={as:e,type:"always",mode:(s==null?void 0:s.mode)??"virtual"},this}buildForeignKeys(e,s){return this.foreignKeyConfigs.map(({ref:i,actions:n})=>((o,l)=>{const c=new ct(()=>{const f=o();return{columns:[e],foreignColumns:[f]}});return l.onUpdate&&c.onUpdate(l.onUpdate),l.onDelete&&c.onDelete(l.onDelete),c.build(s)})(i,n))}}a(F,Ss,"SQLiteColumnBuilder");var qs,Ts;class A extends(Ts=L,qs=m,Ts){constructor(t,e){e.uniqueName||(e.uniqueName=Fa(t,[e.name])),super(t,e),this.table=t}}a(A,qs,"SQLiteColumn");var xs,$s;class Hi extends($s=F,xs=m,$s){constructor(t){super(t,"bigint","SQLiteBigInt")}build(t){return new Zi(t,this.config)}}a(Hi,xs,"SQLiteBigIntBuilder");var Qs,Ns;class Zi extends(Ns=A,Qs=m,Ns){getSQLType(){return"blob"}mapFromDriverValue(t){if(Buffer.isBuffer(t))return BigInt(t.toString());if(t instanceof ArrayBuffer){const e=new TextDecoder;return BigInt(e.decode(t))}return BigInt(String.fromCodePoint(...t))}mapToDriverValue(t){return Buffer.from(t.toString())}}a(Zi,Qs,"SQLiteBigInt");var Cs,Ls;class Xi extends(Ls=F,Cs=m,Ls){constructor(t){super(t,"json","SQLiteBlobJson")}build(t){return new en(t,this.config)}}a(Xi,Cs,"SQLiteBlobJsonBuilder");var Os,_s;class en extends(_s=A,Os=m,_s){getSQLType(){return"blob"}mapFromDriverValue(t){if(Buffer.isBuffer(t))return JSON.parse(t.toString());if(t instanceof ArrayBuffer){const e=new TextDecoder;return JSON.parse(e.decode(t))}return JSON.parse(String.fromCodePoint(...t))}mapToDriverValue(t){return Buffer.from(JSON.stringify(t))}}a(en,Os,"SQLiteBlobJson");var Bs,Ps;class tn extends(Ps=F,Bs=m,Ps){constructor(t){super(t,"buffer","SQLiteBlobBuffer")}build(t){return new sn(t,this.config)}}a(tn,Bs,"SQLiteBlobBufferBuilder");var js,Ms;class sn extends(Ms=A,js=m,Ms){mapFromDriverValue(t){return Buffer.isBuffer(t)?t:Buffer.from(t)}getSQLType(){return"blob"}}a(sn,js,"SQLiteBlobBuffer");function za(r,t){const{name:e,config:s}=he(r,t);return(s==null?void 0:s.mode)==="json"?new Xi(e):(s==null?void 0:s.mode)==="bigint"?new Hi(e):new tn(e)}var Es,As;class rn extends(As=F,Es=m,As){constructor(t,e,s){super(t,"custom","SQLiteCustomColumn"),this.config.fieldConfig=e,this.config.customTypeParams=s}build(t){return new nn(t,this.config)}}a(rn,Es,"SQLiteCustomColumnBuilder");var Ds,Is;class nn extends(Is=A,Ds=m,Is){constructor(e,s){super(e,s);a(this,"sqlName");a(this,"mapTo");a(this,"mapFrom");this.sqlName=s.customTypeParams.dataType(s.fieldConfig),this.mapTo=s.customTypeParams.toDriver,this.mapFrom=s.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}}a(nn,Ds,"SQLiteCustomColumn");function Ka(r){return(t,e)=>{const{name:s,config:i}=he(t,e);return new rn(s,i,r)}}var Rs,Fs;class Be extends(Fs=F,Rs=m,Fs){constructor(t,e,s){super(t,e,s),this.config.autoIncrement=!1}primaryKey(t){return t!=null&&t.autoIncrement&&(this.config.autoIncrement=!0),this.config.hasDefault=!0,super.primaryKey()}}a(Be,Rs,"SQLiteBaseIntegerBuilder");var zs,Ks;class Pe extends(Ks=A,zs=m,Ks){constructor(){super(...arguments);a(this,"autoIncrement",this.config.autoIncrement)}getSQLType(){return"integer"}}a(Pe,zs,"SQLiteBaseInteger");var ks,Vs;class an extends(Vs=Be,ks=m,Vs){constructor(t){super(t,"number","SQLiteInteger")}build(t){return new on(t,this.config)}}a(an,ks,"SQLiteIntegerBuilder");var Us,Js;class on extends(Js=Pe,Us=m,Js){}a(on,Us,"SQLiteInteger");var Ws,Ys;class ln extends(Ys=Be,Ws=m,Ys){constructor(t,e){super(t,"date","SQLiteTimestamp"),this.config.mode=e}defaultNow(){return this.default(u`(cast((julianday('now') - 2440587.5)*86400000 as integer))`)}build(t){return new cn(t,this.config)}}a(ln,Ws,"SQLiteTimestampBuilder");var Gs,Hs;class cn extends(Hs=Pe,Gs=m,Hs){constructor(){super(...arguments);a(this,"mode",this.config.mode)}mapFromDriverValue(e){return this.config.mode==="timestamp"?new Date(e*1e3):new Date(e)}mapToDriverValue(e){const s=e.getTime();return this.config.mode==="timestamp"?Math.floor(s/1e3):s}}a(cn,Gs,"SQLiteTimestamp");var Zs,Xs;class un extends(Xs=Be,Zs=m,Xs){constructor(t,e){super(t,"boolean","SQLiteBoolean"),this.config.mode=e}build(t){return new hn(t,this.config)}}a(un,Zs,"SQLiteBooleanBuilder");var er,tr;class hn extends(tr=Pe,er=m,tr){constructor(){super(...arguments);a(this,"mode",this.config.mode)}mapFromDriverValue(e){return Number(e)===1}mapToDriverValue(e){return e?1:0}}a(hn,er,"SQLiteBoolean");function fn(r,t){const{name:e,config:s}=he(r,t);return(s==null?void 0:s.mode)==="timestamp"||(s==null?void 0:s.mode)==="timestamp_ms"?new ln(e,s.mode):(s==null?void 0:s.mode)==="boolean"?new un(e,s.mode):new an(e)}const oo=fn;var sr,rr;class dn extends(rr=F,sr=m,rr){constructor(t){super(t,"string","SQLiteNumeric")}build(t){return new mn(t,this.config)}}a(dn,sr,"SQLiteNumericBuilder");var ir,nr;class mn extends(nr=A,ir=m,nr){mapFromDriverValue(t){return typeof t=="string"?t:String(t)}getSQLType(){return"numeric"}}a(mn,ir,"SQLiteNumeric");var ar,or;class yn extends(or=F,ar=m,or){constructor(t){super(t,"number","SQLiteNumericNumber")}build(t){return new pn(t,this.config)}}a(yn,ar,"SQLiteNumericNumberBuilder");var lr,cr;class pn extends(cr=A,lr=m,cr){constructor(){super(...arguments);a(this,"mapToDriverValue",String)}mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}getSQLType(){return"numeric"}}a(pn,lr,"SQLiteNumericNumber");var ur,hr;class bn extends(hr=F,ur=m,hr){constructor(t){super(t,"bigint","SQLiteNumericBigInt")}build(t){return new gn(t,this.config)}}a(bn,ur,"SQLiteNumericBigIntBuilder");var fr,dr;class gn extends(dr=A,fr=m,dr){constructor(){super(...arguments);a(this,"mapFromDriverValue",BigInt);a(this,"mapToDriverValue",String)}getSQLType(){return"numeric"}}a(gn,fr,"SQLiteNumericBigInt");function ka(r,t){const{name:e,config:s}=he(r,t),i=s==null?void 0:s.mode;return i==="number"?new yn(e):i==="bigint"?new bn(e):new dn(e)}var mr,yr;class wn extends(yr=F,mr=m,yr){constructor(t){super(t,"number","SQLiteReal")}build(t){return new Sn(t,this.config)}}a(wn,mr,"SQLiteRealBuilder");var pr,br;class Sn extends(br=A,pr=m,br){getSQLType(){return"real"}}a(Sn,pr,"SQLiteReal");function Va(r){return new wn(r??"")}var gr,wr;class vn extends(wr=F,gr=m,wr){constructor(t,e){super(t,"string","SQLiteText"),this.config.enumValues=e.enum,this.config.length=e.length}build(t){return new qn(t,this.config)}}a(vn,gr,"SQLiteTextBuilder");var Sr,vr;class qn extends(vr=A,Sr=m,vr){constructor(e,s){super(e,s);a(this,"enumValues",this.config.enumValues);a(this,"length",this.config.length)}getSQLType(){return`text${this.config.length?`(${this.config.length})`:""}`}}a(qn,Sr,"SQLiteText");var qr,Tr;class Tn extends(Tr=F,qr=m,Tr){constructor(t){super(t,"json","SQLiteTextJson")}build(t){return new xn(t,this.config)}}a(Tn,qr,"SQLiteTextJsonBuilder");var xr,$r;class xn extends($r=A,xr=m,$r){getSQLType(){return"text"}mapFromDriverValue(t){return JSON.parse(t)}mapToDriverValue(t){return JSON.stringify(t)}}a(xn,xr,"SQLiteTextJson");function Ua(r,t={}){const{name:e,config:s}=he(r,t);return s.mode==="json"?new Tn(e):new vn(e,s)}function Ja(){return{blob:za,customType:Ka,integer:fn,numeric:ka,real:Va,text:Ua}}const He=Symbol.for("drizzle:SQLiteInlineForeignKeys");var Qr,Nr,Cr,Lr,Or;class D extends(Or=p,Lr=m,Cr=p.Symbol.Columns,Nr=He,Qr=p.Symbol.ExtraConfigBuilder,Or){constructor(){super(...arguments);a(this,Cr);a(this,Nr,[]);a(this,Qr)}}a(D,Lr,"SQLiteTable"),a(D,"Symbol",Object.assign({},p.Symbol,{InlineForeignKeys:He}));function Wa(r,t,e,s,i=r){const n=new D(r,s,i),o=typeof t=="function"?t(Ja()):t,l=Object.fromEntries(Object.entries(o).map(([f,h])=>{const b=h;b.setName(f);const y=b.build(n);return n[He].push(...b.buildForeignKeys(y,n)),[f,y]})),c=Object.assign(n,l);return c[p.Symbol.Columns]=l,c[p.Symbol.ExtraConfigColumns]=l,e&&(c[D.Symbol.ExtraConfigBuilder]=e),c}const lo=(r,t,e)=>Wa(r,t,e);function H(r){return d(r,D)?[`${r[p.Symbol.BaseName]}`]:d(r,R)?r._.usedTables??[]:d(r,w)?r.usedTables??[]:[]}var _r,Br;class Ze extends(Br=Y,_r=m,Br){constructor(e,s,i,n){super();a(this,"config");a(this,"run",e=>this._prepare().run(e));a(this,"all",e=>this._prepare().all(e));a(this,"get",e=>this._prepare().get(e));a(this,"values",e=>this._prepare().values(e));this.table=e,this.session=s,this.dialect=i,this.config={table:e,withList:n}}where(e){return this.config.where=e,this}orderBy(...e){if(typeof e[0]=="function"){const s=e[0](new Proxy(this.config.table[p.Symbol.Columns],new E({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(s)?s:[s];this.config.orderBy=i}else{const s=e;this.config.orderBy=s}return this}limit(e){return this.config.limit=e,this}returning(e=this.table[D.Symbol.Columns]){return this.config.returning=X(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){const{typings:e,...s}=this.dialect.sqlToQuery(this.getSQL());return s}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"delete",tables:H(this.config.table)})}prepare(){return this._prepare(!1)}async execute(e){return this._prepare().execute(e)}$dynamic(){return this}}a(Ze,_r,"SQLiteDelete");function Ya(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(e=>e.toLowerCase()).join("_")}function Ga(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((e,s,i)=>{const n=i===0?s.toLowerCase():`${s[0].toUpperCase()}${s.slice(1)}`;return e+n},"")}function Ha(r){return r}var Pr;Pr=m;class $n{constructor(t){a(this,"cache",{});a(this,"cachedTables",{});a(this,"convert");this.convert=t==="snake_case"?Ya:t==="camelCase"?Ga:Ha}getColumnCasing(t){if(!t.keyAsName)return t.name;const e=t.table[p.Symbol.Schema]??"public",s=t.table[p.Symbol.OriginalName],i=`${e}.${s}.${t.name}`;return this.cache[i]||this.cacheTable(t.table),this.cache[i]}cacheTable(t){const e=t[p.Symbol.Schema]??"public",s=t[p.Symbol.OriginalName],i=`${e}.${s}`;if(!this.cachedTables[i]){for(const n of Object.values(t[p.Symbol.Columns])){const o=`${i}.${n.name}`;this.cache[o]=this.convert(n.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}}a($n,Pr,"CasingCache");var jr,Mr;class je extends(Mr=Error,jr=m,Mr){constructor({message:t,cause:e}){super(t),this.name="DrizzleError",this.cause=e}}a(je,jr,"DrizzleError");var Er,Ar;class Qn extends(Ar=je,Er=m,Ar){constructor(){super({message:"Rollback"})}}a(Qn,Er,"TransactionRollbackError");var Dr,Ir;class Me extends(Ir=te,Dr=m,Ir){}a(Me,Dr,"SQLiteViewBase");var Rr;Rr=m;class ue{constructor(t){a(this,"casing");this.casing=new $n(t==null?void 0:t.casing)}escapeName(t){return`"${t}"`}escapeParam(t){return"?"}escapeString(t){return`'${t.replace(/'/g,"''")}'`}buildWithCTE(t){if(!(t!=null&&t.length))return;const e=[u`with `];for(const[s,i]of t.entries())e.push(u`${u.identifier(i._.alias)} as (${i._.sql})`),s<t.length-1&&e.push(u`, `);return e.push(u` `),u.join(e)}buildDeleteQuery({table:t,where:e,returning:s,withList:i,limit:n,orderBy:o}){const l=this.buildWithCTE(i),c=s?u` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,f=e?u` where ${e}`:void 0,h=this.buildOrderBy(o),b=this.buildLimit(n);return u`${l}delete from ${t}${f}${c}${h}${b}`}buildUpdateSet(t,e){const s=t[p.Symbol.Columns],i=Object.keys(s).filter(o=>{var l;return e[o]!==void 0||((l=s[o])==null?void 0:l.onUpdateFn)!==void 0}),n=i.length;return u.join(i.flatMap((o,l)=>{const c=s[o],f=e[o]??u.param(c.onUpdateFn(),c),h=u`${u.identifier(this.casing.getColumnCasing(c))} = ${f}`;return l<n-1?[h,u.raw(", ")]:[h]}))}buildUpdateQuery({table:t,set:e,where:s,returning:i,withList:n,joins:o,from:l,limit:c,orderBy:f}){const h=this.buildWithCTE(n),b=this.buildUpdateSet(t,e),y=l&&u.join([u.raw(" from "),this.buildFromTable(l)]),g=this.buildJoins(o),q=i?u` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,v=s?u` where ${s}`:void 0,T=this.buildOrderBy(f),Q=this.buildLimit(c);return u`${h}update ${t} set ${b}${y}${g}${v}${q}${T}${Q}`}buildSelection(t,{isSingleTable:e=!1}={}){const s=t.length,i=t.flatMap(({field:n},o)=>{const l=[];if(d(n,w.Aliased)&&n.isSelectionField)l.push(u.identifier(n.fieldAlias));else if(d(n,w.Aliased)||d(n,w)){const c=d(n,w.Aliased)?n.sql:n;e?l.push(new w(c.queryChunks.map(f=>d(f,L)?u.identifier(this.casing.getColumnCasing(f)):f))):l.push(c),d(n,w.Aliased)&&l.push(u` as ${u.identifier(n.fieldAlias)}`)}else if(d(n,L)){const c=n.table[p.Symbol.Name];n.columnType==="SQLiteNumericBigInt"?e?l.push(u`cast(${u.identifier(this.casing.getColumnCasing(n))} as text)`):l.push(u`cast(${u.identifier(c)}.${u.identifier(this.casing.getColumnCasing(n))} as text)`):e?l.push(u.identifier(this.casing.getColumnCasing(n))):l.push(u`${u.identifier(c)}.${u.identifier(this.casing.getColumnCasing(n))}`)}return o<s-1&&l.push(u`, `),l});return u.join(i)}buildJoins(t){if(!t||t.length===0)return;const e=[];if(t)for(const[s,i]of t.entries()){s===0&&e.push(u` `);const n=i.table,o=i.on?u` on ${i.on}`:void 0;if(d(n,D)){const l=n[D.Symbol.Name],c=n[D.Symbol.Schema],f=n[D.Symbol.OriginalName],h=l===f?void 0:i.alias;e.push(u`${u.raw(i.joinType)} join ${c?u`${u.identifier(c)}.`:void 0}${u.identifier(f)}${h&&u` ${u.identifier(h)}`}${o}`)}else e.push(u`${u.raw(i.joinType)} join ${n}${o}`);s<t.length-1&&e.push(u` `)}return u.join(e)}buildLimit(t){return typeof t=="object"||typeof t=="number"&&t>=0?u` limit ${t}`:void 0}buildOrderBy(t){const e=[];if(t)for(const[s,i]of t.entries())e.push(i),s<t.length-1&&e.push(u`, `);return e.length>0?u` order by ${u.join(e)}`:void 0}buildFromTable(t){return d(t,p)&&t[p.Symbol.IsAlias]?u`${u`${u.identifier(t[p.Symbol.Schema]??"")}.`.if(t[p.Symbol.Schema])}${u.identifier(t[p.Symbol.OriginalName])} ${u.identifier(t[p.Symbol.Name])}`:t}buildSelectQuery({withList:t,fields:e,fieldsFlat:s,where:i,having:n,table:o,joins:l,orderBy:c,groupBy:f,limit:h,offset:b,distinct:y,setOperators:g}){const q=s??X(e);for(const z of q)if(d(z.field,L)&&ne(z.field.table)!==(d(o,R)?o._.alias:d(o,Me)?o[P].name:d(o,w)?void 0:ne(o))&&!(K=>l==null?void 0:l.some(({alias:fe})=>fe===(K[p.Symbol.IsAlias]?ne(K):K[p.Symbol.BaseName])))(z.field.table)){const K=ne(z.field.table);throw new Error(`Your "${z.path.join("->")}" field references a column "${K}"."${z.field.name}", but the table "${K}" is not part of the query! Did you forget to join it?`)}const v=!l||l.length===0,T=this.buildWithCTE(t),Q=y?u` distinct`:void 0,C=this.buildSelection(q,{isSingleTable:v}),N=this.buildFromTable(o),x=this.buildJoins(l),_=i?u` where ${i}`:void 0,j=n?u` having ${n}`:void 0,S=[];if(f)for(const[z,K]of f.entries())S.push(K),z<f.length-1&&S.push(u`, `);const $=S.length>0?u` group by ${u.join(S)}`:void 0,B=this.buildOrderBy(c),M=this.buildLimit(h),se=b?u` offset ${b}`:void 0,re=u`${T}select${Q} ${C} from ${N}${x}${_}${$}${j}${B}${M}${se}`;return g.length>0?this.buildSetOperations(re,g):re}buildSetOperations(t,e){const[s,...i]=e;if(!s)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:t,setOperator:s}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:t,setOperator:s}),i)}buildSetOperationQuery({leftSelect:t,setOperator:{type:e,isAll:s,rightSelect:i,limit:n,orderBy:o,offset:l}}){const c=u`${t.getSQL()} `,f=u`${i.getSQL()}`;let h;if(o&&o.length>0){const q=[];for(const v of o)if(d(v,A))q.push(u.identifier(v.name));else if(d(v,w)){for(let T=0;T<v.queryChunks.length;T++){const Q=v.queryChunks[T];d(Q,A)&&(v.queryChunks[T]=u.identifier(this.casing.getColumnCasing(Q)))}q.push(u`${v}`)}else q.push(u`${v}`);h=u` order by ${u.join(q,u`, `)}`}const b=typeof n=="object"||typeof n=="number"&&n>=0?u` limit ${n}`:void 0,y=u.raw(`${e} ${s?"all ":""}`),g=l?u` offset ${l}`:void 0;return u`${c}${y}${f}${h}${b}${g}`}buildInsertQuery({table:t,values:e,onConflict:s,returning:i,withList:n,select:o}){const l=[],c=t[p.Symbol.Columns],f=Object.entries(c).filter(([v,T])=>!T.shouldDisableInsert()),h=f.map(([,v])=>u.identifier(this.casing.getColumnCasing(v)));if(o){const v=e;d(v,w)?l.push(v):l.push(v.getSQL())}else{const v=e;l.push(u.raw("values "));for(const[T,Q]of v.entries()){const C=[];for(const[N,x]of f){const _=Q[N];if(_===void 0||d(_,U)&&_.value===void 0){let j;if(x.default!==null&&x.default!==void 0)j=d(x.default,w)?x.default:u.param(x.default,x);else if(x.defaultFn!==void 0){const S=x.defaultFn();j=d(S,w)?S:u.param(S,x)}else if(!x.default&&x.onUpdateFn!==void 0){const S=x.onUpdateFn();j=d(S,w)?S:u.param(S,x)}else j=u`null`;C.push(j)}else C.push(_)}l.push(C),T<v.length-1&&l.push(u`, `)}}const b=this.buildWithCTE(n),y=u.join(l),g=i?u` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,q=s!=null&&s.length?u.join(s):void 0;return u`${b}insert into ${t} ${h} ${y}${q}${g}`}sqlToQuery(t,e){return t.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:e})}buildRelationalQuery({fullSchema:t,schema:e,tableNamesMap:s,table:i,tableConfig:n,queryConfig:o,tableAlias:l,nestedQueryRelation:c,joinOn:f}){let h=[],b,y,g=[],q;const v=[];if(o===!0)h=Object.entries(n.columns).map(([C,N])=>({dbKey:N.name,tsKey:C,field:k(N,l),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{const Q=Object.fromEntries(Object.entries(n.columns).map(([S,$])=>[S,k($,l)]));if(o.where){const S=typeof o.where=="function"?o.where(Q,ja()):o.where;q=S&&$e(S,l)}const C=[];let N=[];if(o.columns){let S=!1;for(const[$,B]of Object.entries(o.columns))B!==void 0&&$ in n.columns&&(!S&&B===!0&&(S=!0),N.push($));N.length>0&&(N=S?N.filter($=>{var B;return((B=o.columns)==null?void 0:B[$])===!0}):Object.keys(n.columns).filter($=>!N.includes($)))}else N=Object.keys(n.columns);for(const S of N){const $=n.columns[S];C.push({tsKey:S,value:$})}let x=[];o.with&&(x=Object.entries(o.with).filter(S=>!!S[1]).map(([S,$])=>({tsKey:S,queryConfig:$,relation:n.relations[S]})));let _;if(o.extras){_=typeof o.extras=="function"?o.extras(Q,{sql:u}):o.extras;for(const[S,$]of Object.entries(_))C.push({tsKey:S,value:Yi($,l)})}for(const{tsKey:S,value:$}of C)h.push({dbKey:d($,w.Aliased)?$.fieldAlias:n.columns[S].name,tsKey:S,field:d($,L)?k($,l):$,relationTableTsKey:void 0,isJson:!1,selection:[]});let j=typeof o.orderBy=="function"?o.orderBy(Q,Ma()):o.orderBy??[];Array.isArray(j)||(j=[j]),g=j.map(S=>d(S,L)?k(S,l):$e(S,l)),b=o.limit,y=o.offset;for(const{tsKey:S,queryConfig:$,relation:B}of x){const M=Ia(e,s,B),se=le(B.referencedTable),re=s[se],z=`${l}_${S}`,K=Ye(...M.fields.map((zn,Kn)=>Ji(k(M.references[Kn],z),k(zn,l)))),fe=this.buildRelationalQuery({fullSchema:t,schema:e,tableNamesMap:s,table:t[re],tableConfig:e[re],queryConfig:d(B,ee)?$===!0?{limit:1}:{...$,limit:1}:$,tableAlias:z,joinOn:K,nestedQueryRelation:B}),Fn=u`(${fe.sql})`.as(S);h.push({dbKey:S,tsKey:S,field:Fn,relationTableTsKey:re,isJson:!0,selection:fe.selection})}}if(h.length===0)throw new je({message:`No fields selected for table "${n.tsName}" ("${l}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});let T;if(q=Ye(f,q),c){let Q=u`json_array(${u.join(h.map(({field:x})=>d(x,A)?u.identifier(this.casing.getColumnCasing(x)):d(x,w.Aliased)?x.sql:x),u`, `)})`;d(c,xe)&&(Q=u`coalesce(json_group_array(${Q}), json_array())`);const C=[{dbKey:"data",tsKey:"data",field:Q.as("data"),isJson:!0,relationTableTsKey:n.tsName,selection:h}];b!==void 0||y!==void 0||g.length>0?(T=this.buildSelectQuery({table:ze(i,l),fields:{},fieldsFlat:[{path:[],field:u.raw("*")}],where:q,limit:b,offset:y,orderBy:g,setOperators:[]}),q=void 0,b=void 0,y=void 0,g=void 0):T=ze(i,l),T=this.buildSelectQuery({table:d(T,D)?T:new R(T,{},l),fields:{},fieldsFlat:C.map(({field:x})=>({path:[],field:d(x,L)?k(x,l):x})),joins:v,where:q,limit:b,offset:y,orderBy:g,setOperators:[]})}else T=this.buildSelectQuery({table:ze(i,l),fields:{},fieldsFlat:h.map(({field:Q})=>({path:[],field:d(Q,L)?k(Q,l):Q})),joins:v,where:q,limit:b,offset:y,orderBy:g,setOperators:[]});return{tableTsKey:n.tsName,sql:T,selection:h}}}a(ue,Rr,"SQLiteDialect");var Fr,zr;class Nn extends(zr=ue,Fr=m,zr){migrate(t,e,s){const i=s===void 0||typeof s=="string"?"__drizzle_migrations":s.migrationsTable??"__drizzle_migrations",n=u`
			CREATE TABLE IF NOT EXISTS ${u.identifier(i)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;e.run(n);const l=e.values(u`SELECT id, hash, created_at FROM ${u.identifier(i)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;e.run(u`BEGIN`);try{for(const c of t)if(!l||Number(l[2])<c.folderMillis){for(const f of c.sql)e.run(u.raw(f));e.run(u`INSERT INTO ${u.identifier(i)} ("hash", "created_at") VALUES(${c.hash}, ${c.folderMillis})`)}e.run(u`COMMIT`)}catch(c){throw e.run(u`ROLLBACK`),c}}}a(Nn,Fr,"SQLiteSyncDialect");var Kr,kr;class Cn extends(kr=ue,Kr=m,kr){async migrate(t,e,s){const i=s===void 0||typeof s=="string"?"__drizzle_migrations":s.migrationsTable??"__drizzle_migrations",n=u`
			CREATE TABLE IF NOT EXISTS ${u.identifier(i)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await e.run(n);const l=(await e.values(u`SELECT id, hash, created_at FROM ${u.identifier(i)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await e.transaction(async c=>{for(const f of t)if(!l||Number(l[2])<f.folderMillis){for(const h of f.sql)await c.run(u.raw(h));await c.run(u`INSERT INTO ${u.identifier(i)} ("hash", "created_at") VALUES(${f.hash}, ${f.folderMillis})`)}})}}a(Cn,Kr,"SQLiteAsyncDialect");var Vr;Vr=m;class Ln{getSelectedFields(){return this._.selectedFields}}a(Ln,Vr,"TypedQueryBuilder");var Ur;Ur=m;class V{constructor(t){a(this,"fields");a(this,"session");a(this,"dialect");a(this,"withList");a(this,"distinct");this.fields=t.fields,this.session=t.session,this.dialect=t.dialect,this.withList=t.withList,this.distinct=t.distinct}from(t){const e=!!this.fields;let s;return this.fields?s=this.fields:d(t,R)?s=Object.fromEntries(Object.keys(t._.selectedFields).map(i=>[i,t[i]])):d(t,Me)?s=t[P].selectedFields:d(t,w)?s={}:s=fa(t),new ut({table:t,fields:s,isPartialSelect:e,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}a(V,Ur,"SQLiteSelectBuilder");var Jr,Wr;class On extends(Wr=Ln,Jr=m,Wr){constructor({table:e,fields:s,isPartialSelect:i,session:n,dialect:o,withList:l,distinct:c}){super();a(this,"_");a(this,"config");a(this,"joinsNotNullableMap");a(this,"tableName");a(this,"isPartialSelect");a(this,"session");a(this,"dialect");a(this,"cacheConfig");a(this,"usedTables",new Set);a(this,"leftJoin",this.createJoin("left"));a(this,"rightJoin",this.createJoin("right"));a(this,"innerJoin",this.createJoin("inner"));a(this,"fullJoin",this.createJoin("full"));a(this,"crossJoin",this.createJoin("cross"));a(this,"union",this.createSetOperator("union",!1));a(this,"unionAll",this.createSetOperator("union",!0));a(this,"intersect",this.createSetOperator("intersect",!1));a(this,"except",this.createSetOperator("except",!1));this.config={withList:l,table:e,fields:{...s},distinct:c,setOperators:[]},this.isPartialSelect=i,this.session=n,this.dialect=o,this._={selectedFields:s,config:this.config},this.tableName=Je(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{};for(const f of H(e))this.usedTables.add(f)}getUsedTables(){return[...this.usedTables]}createJoin(e){return(s,i)=>{var l;const n=this.tableName,o=Je(s);for(const c of H(s))this.usedTables.add(c);if(typeof o=="string"&&((l=this.config.joins)!=null&&l.some(c=>c.alias===o)))throw new Error(`Alias "${o}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof n=="string"&&(this.config.fields={[n]:this.config.fields}),typeof o=="string"&&!d(s,w))){const c=d(s,R)?s._.selectedFields:d(s,te)?s[P].selectedFields:s[p.Symbol.Columns];this.config.fields[o]=c}if(typeof i=="function"&&(i=i(new Proxy(this.config.fields,new E({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:i,table:s,joinType:e,alias:o}),typeof o=="string")switch(e){case"left":{this.joinsNotNullableMap[o]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([c])=>[c,!1])),this.joinsNotNullableMap[o]=!0;break}case"cross":case"inner":{this.joinsNotNullableMap[o]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([c])=>[c,!1])),this.joinsNotNullableMap[o]=!1;break}}return this}}createSetOperator(e,s){return i=>{const n=typeof i=="function"?i(Za()):i;if(!ot(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:s,rightSelect:n}),this}}addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new E({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new E({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){const s=e[0](new Proxy(this.config.fields,new E({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(s)?s:[s]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){const s=e[0](new Proxy(this.config.fields,new E({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(s)?s:[s];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}else{const s=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=s:this.config.orderBy=s}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){const{typings:e,...s}=this.dialect.sqlToQuery(this.getSQL());return s}as(e){const s=[];if(s.push(...H(this.config.table)),this.config.joins)for(const i of this.config.joins)s.push(...H(i.table));return new Proxy(new R(this.getSQL(),this.config.fields,e,!1,[...new Set(s)]),new E({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new E({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}a(On,Jr,"SQLiteSelectQueryBuilder");var Yr,Gr;class ut extends(Gr=On,Yr=m,Gr){constructor(){super(...arguments);a(this,"run",e=>this._prepare().run(e));a(this,"all",e=>this._prepare().all(e));a(this,"get",e=>this._prepare().get(e));a(this,"values",e=>this._prepare().values(e))}_prepare(e=!0){if(!this.session)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");const s=X(this.config.fields),i=this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),s,"all",!0,void 0,{type:"select",tables:[...this.usedTables]},this.cacheConfig);return i.joinsNotNullableMap=this.joinsNotNullableMap,i}$withCache(e){return this.cacheConfig=e===void 0?{config:{},enable:!0,autoInvalidate:!0}:e===!1?{enable:!1}:{enable:!0,autoInvalidate:!0,...e},this}prepare(){return this._prepare(!1)}async execute(){return this.all()}}a(ut,Yr,"SQLiteSelect");ha(ut,[Y]);function Ee(r,t){return(e,s,...i)=>{const n=[s,...i].map(o=>({type:r,isAll:t,rightSelect:o}));for(const o of n)if(!ot(e.getSelectedFields(),o.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return e.addSetOperators(n)}}const Za=()=>({union:Xa,unionAll:eo,intersect:to,except:so}),Xa=Ee("union",!1),eo=Ee("union",!0),to=Ee("intersect",!1),so=Ee("except",!1);var Hr;Hr=m;class ht{constructor(t){a(this,"dialect");a(this,"dialectConfig");a(this,"$with",(t,e)=>{const s=this;return{as:n=>(typeof n=="function"&&(n=n(s)),new Proxy(new at(n.getSQL(),e??("getSelectedFields"in n?n.getSelectedFields()??{}:{}),t,!0),new E({alias:t,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}});this.dialect=d(t,ue)?t:void 0,this.dialectConfig=d(t,ue)?void 0:t}with(...t){const e=this;function s(n){return new V({fields:n??void 0,session:void 0,dialect:e.getDialect(),withList:t})}function i(n){return new V({fields:n??void 0,session:void 0,dialect:e.getDialect(),withList:t,distinct:!0})}return{select:s,selectDistinct:i}}select(t){return new V({fields:t??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(t){return new V({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){return this.dialect||(this.dialect=new Nn(this.dialectConfig)),this.dialect}}a(ht,Hr,"SQLiteQueryBuilder");var Zr;Zr=m;class Xe{constructor(t,e,s,i){this.table=t,this.session=e,this.dialect=s,this.withList=i}values(t){if(t=Array.isArray(t)?t:[t],t.length===0)throw new Error("values() must be called with at least one value");const e=t.map(s=>{const i={},n=this.table[p.Symbol.Columns];for(const o of Object.keys(s)){const l=s[o];i[o]=d(l,w)?l:new U(l,n[o])}return i});return new et(this.table,e,this.session,this.dialect,this.withList)}select(t){const e=typeof t=="function"?t(new ht):t;if(!d(e,w)&&!ot(this.table[Ue],e._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new et(this.table,e,this.session,this.dialect,this.withList,!0)}}a(Xe,Zr,"SQLiteInsertBuilder");var Xr,ei;class et extends(ei=Y,Xr=m,ei){constructor(e,s,i,n,o,l){super();a(this,"config");a(this,"run",e=>this._prepare().run(e));a(this,"all",e=>this._prepare().all(e));a(this,"get",e=>this._prepare().get(e));a(this,"values",e=>this._prepare().values(e));this.session=i,this.dialect=n,this.config={table:e,values:s,withList:o,select:l}}returning(e=this.config.table[D.Symbol.Columns]){return this.config.returning=X(e),this}onConflictDoNothing(e={}){if(this.config.onConflict||(this.config.onConflict=[]),e.target===void 0)this.config.onConflict.push(u` on conflict do nothing`);else{const s=Array.isArray(e.target)?u`${e.target}`:u`${[e.target]}`,i=e.where?u` where ${e.where}`:u``;this.config.onConflict.push(u` on conflict ${s} do nothing${i}`)}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');this.config.onConflict||(this.config.onConflict=[]);const s=e.where?u` where ${e.where}`:void 0,i=e.targetWhere?u` where ${e.targetWhere}`:void 0,n=e.setWhere?u` where ${e.setWhere}`:void 0,o=Array.isArray(e.target)?u`${e.target}`:u`${[e.target]}`,l=this.dialect.buildUpdateSet(this.config.table,ki(this.config.table,e.set));return this.config.onConflict.push(u` on conflict ${o}${i} do update set ${l}${s}${n}`),this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){const{typings:e,...s}=this.dialect.sqlToQuery(this.getSQL());return s}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:H(this.config.table)})}prepare(){return this._prepare(!1)}async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}a(et,Xr,"SQLiteInsert");var ti;ti=m;class tt{constructor(t,e,s,i){this.table=t,this.session=e,this.dialect=s,this.withList=i}set(t){return new _n(this.table,ki(this.table,t),this.session,this.dialect,this.withList)}}a(tt,ti,"SQLiteUpdateBuilder");var si,ri;class _n extends(ri=Y,si=m,ri){constructor(e,s,i,n,o){super();a(this,"config");a(this,"leftJoin",this.createJoin("left"));a(this,"rightJoin",this.createJoin("right"));a(this,"innerJoin",this.createJoin("inner"));a(this,"fullJoin",this.createJoin("full"));a(this,"run",e=>this._prepare().run(e));a(this,"all",e=>this._prepare().all(e));a(this,"get",e=>this._prepare().get(e));a(this,"values",e=>this._prepare().values(e));this.session=i,this.dialect=n,this.config={set:s,table:e,withList:o,joins:[]}}from(e){return this.config.from=e,this}createJoin(e){return(s,i)=>{const n=Je(s);if(typeof n=="string"&&this.config.joins.some(o=>o.alias===n))throw new Error(`Alias "${n}" is already used in this query`);if(typeof i=="function"){const o=this.config.from?d(s,D)?s[p.Symbol.Columns]:d(s,R)?s._.selectedFields:d(s,Me)?s[P].selectedFields:void 0:void 0;i=i(new Proxy(this.config.table[p.Symbol.Columns],new E({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),o&&new Proxy(o,new E({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}return this.config.joins.push({on:i,table:s,joinType:e,alias:n}),this}}where(e){return this.config.where=e,this}orderBy(...e){if(typeof e[0]=="function"){const s=e[0](new Proxy(this.config.table[p.Symbol.Columns],new E({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(s)?s:[s];this.config.orderBy=i}else{const s=e;this.config.orderBy=s}return this}limit(e){return this.config.limit=e,this}returning(e=this.config.table[D.Symbol.Columns]){return this.config.returning=X(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){const{typings:e,...s}=this.dialect.sqlToQuery(this.getSQL());return s}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:H(this.config.table)})}prepare(){return this._prepare(!1)}async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}a(_n,si,"SQLiteUpdate");var ii,ni,ai;const oe=class oe extends(ai=w,ni=m,ii=Symbol.toStringTag,ai){constructor(e){super(oe.buildEmbeddedCount(e.source,e.filters).queryChunks);a(this,"sql");a(this,ii,"SQLiteCountBuilderAsync");a(this,"session");this.params=e,this.session=e.session,this.sql=oe.buildCount(e.source,e.filters)}static buildEmbeddedCount(e,s){return u`(select count(*) from ${e}${u.raw(" where ").if(s)}${s})`}static buildCount(e,s){return u`select count(*) from ${e}${u.raw(" where ").if(s)}${s}`}then(e,s){return Promise.resolve(this.session.count(this.sql)).then(e,s)}catch(e){return this.then(void 0,e)}finally(e){return this.then(s=>(e==null||e(),s),s=>{throw e==null||e(),s})}};a(oe,ni,"SQLiteCountBuilderAsync");let st=oe;var oi;oi=m;class Bn{constructor(t,e,s,i,n,o,l,c){this.mode=t,this.fullSchema=e,this.schema=s,this.tableNamesMap=i,this.table=n,this.tableConfig=o,this.dialect=l,this.session=c}findMany(t){return this.mode==="sync"?new rt(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,t||{},"many"):new Qe(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,t||{},"many")}findFirst(t){return this.mode==="sync"?new rt(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,t?{...t,limit:1}:{limit:1},"first"):new Qe(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,t?{...t,limit:1}:{limit:1},"first")}}a(Bn,oi,"SQLiteAsyncRelationalQueryBuilder");var li,ci;class Qe extends(ci=Y,li=m,ci){constructor(e,s,i,n,o,l,c,f,h){super();a(this,"mode");this.fullSchema=e,this.schema=s,this.tableNamesMap=i,this.table=n,this.tableConfig=o,this.dialect=l,this.session=c,this.config=f,this.mode=h}getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(e=!1){const{query:s,builtQuery:i}=this._toSQL();return this.session[e?"prepareOneTimeQuery":"prepareQuery"](i,void 0,this.mode==="first"?"get":"all",!0,(n,o)=>{const l=n.map(c=>Ge(this.schema,this.tableConfig,c,s.selection,o));return this.mode==="first"?l[0]:l})}prepare(){return this._prepare(!1)}_toSQL(){const e=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),s=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:s}}toSQL(){return this._toSQL().builtQuery}executeRaw(){return this.mode==="first"?this._prepare(!1).get():this._prepare(!1).all()}async execute(){return this.executeRaw()}}a(Qe,li,"SQLiteAsyncRelationalQuery");var ui,hi;class rt extends(hi=Qe,ui=m,hi){sync(){return this.executeRaw()}}a(rt,ui,"SQLiteSyncRelationalQuery");var fi,di;class ae extends(di=Y,fi=m,di){constructor(e,s,i,n,o){super();a(this,"config");this.execute=e,this.getSQL=s,this.dialect=n,this.mapBatchResult=o,this.config={action:i}}getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(e,s){return s?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}}a(ae,fi,"SQLiteRaw");var mi;mi=m;class ft{constructor(t,e,s,i){a(this,"query");a(this,"$with",(t,e)=>{const s=this;return{as:n=>(typeof n=="function"&&(n=n(new ht(s.dialect))),new Proxy(new at(n.getSQL(),e??("getSelectedFields"in n?n.getSelectedFields()??{}:{}),t,!0),new E({alias:t,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}});a(this,"$cache");this.resultKind=t,this.dialect=e,this.session=s,this._=i?{schema:i.schema,fullSchema:i.fullSchema,tableNamesMap:i.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={};const n=this.query;if(this._.schema)for(const[o,l]of Object.entries(this._.schema))n[o]=new Bn(t,i.fullSchema,this._.schema,this._.tableNamesMap,i.fullSchema[o],l,e,s);this.$cache={invalidate:async o=>{}}}$count(t,e){return new st({source:t,filters:e,session:this.session})}with(...t){const e=this;function s(c){return new V({fields:c??void 0,session:e.session,dialect:e.dialect,withList:t})}function i(c){return new V({fields:c??void 0,session:e.session,dialect:e.dialect,withList:t,distinct:!0})}function n(c){return new tt(c,e.session,e.dialect,t)}function o(c){return new Xe(c,e.session,e.dialect,t)}function l(c){return new Ze(c,e.session,e.dialect,t)}return{select:s,selectDistinct:i,update:n,insert:o,delete:l}}select(t){return new V({fields:t??void 0,session:this.session,dialect:this.dialect})}selectDistinct(t){return new V({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(t){return new tt(t,this.session,this.dialect)}insert(t){return new Xe(t,this.session,this.dialect)}delete(t){return new Ze(t,this.session,this.dialect)}run(t){const e=typeof t=="string"?u.raw(t):t.getSQL();return this.resultKind==="async"?new ae(async()=>this.session.run(e),()=>e,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session)):this.session.run(e)}all(t){const e=typeof t=="string"?u.raw(t):t.getSQL();return this.resultKind==="async"?new ae(async()=>this.session.all(e),()=>e,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session)):this.session.all(e)}get(t){const e=typeof t=="string"?u.raw(t):t.getSQL();return this.resultKind==="async"?new ae(async()=>this.session.get(e),()=>e,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session)):this.session.get(e)}values(t){const e=typeof t=="string"?u.raw(t):t.getSQL();return this.resultKind==="async"?new ae(async()=>this.session.values(e),()=>e,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session)):this.session.values(e)}transaction(t,e){return this.session.transaction(t,e)}}a(ft,mi,"BaseSQLiteDatabase");var yi;yi=m;class Pn{}a(Pn,yi,"Cache");var pi,bi;class dt extends(bi=Pn,pi=m,bi){strategy(){return"all"}async get(t){}async put(t,e,s,i){}async onMutate(t){}}a(dt,pi,"NoopCache");async function Qt(r,t){const e=`${r}-${JSON.stringify(t)}`,i=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",i);return[...new Uint8Array(n)].map(c=>c.toString(16).padStart(2,"0")).join("")}class J extends Error{constructor(t,e,s){super(`Failed query: ${t}
params: ${e}`),this.query=t,this.params=e,this.cause=s,Error.captureStackTrace(this,J),s&&(this.cause=s)}}var gi,wi;class jn extends(wi=Y,gi=m,wi){constructor(t){super(),this.resultCb=t}async execute(){return this.resultCb()}sync(){return this.resultCb()}}a(jn,gi,"ExecuteResultSync");var Si;Si=m;class Mn{constructor(t,e,s,i,n,o){a(this,"joinsNotNullableMap");var l;this.mode=t,this.executeMethod=e,this.query=s,this.cache=i,this.queryMetadata=n,this.cacheConfig=o,i&&i.strategy()==="all"&&o===void 0&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),(l=this.cacheConfig)!=null&&l.enable||(this.cacheConfig=void 0)}async queryWithCache(t,e,s){if(this.cache===void 0||d(this.cache,dt)||this.queryMetadata===void 0)try{return await s()}catch(i){throw new J(t,e,i)}if(this.cacheConfig&&!this.cacheConfig.enable)try{return await s()}catch(i){throw new J(t,e,i)}if((this.queryMetadata.type==="insert"||this.queryMetadata.type==="update"||this.queryMetadata.type==="delete")&&this.queryMetadata.tables.length>0)try{const[i]=await Promise.all([s(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return i}catch(i){throw new J(t,e,i)}if(!this.cacheConfig)try{return await s()}catch(i){throw new J(t,e,i)}if(this.queryMetadata.type==="select"){const i=await this.cache.get(this.cacheConfig.tag??await Qt(t,e),this.queryMetadata.tables,this.cacheConfig.tag!==void 0,this.cacheConfig.autoInvalidate);if(i===void 0){let n;try{n=await s()}catch(o){throw new J(t,e,o)}return await this.cache.put(this.cacheConfig.tag??await Qt(t,e),n,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],this.cacheConfig.tag!==void 0,this.cacheConfig.config),n}return i}try{return await s()}catch(i){throw new J(t,e,i)}}getQuery(){return this.query}mapRunResult(t,e){return t}mapAllResult(t,e){throw new Error("Not implemented")}mapGetResult(t,e){throw new Error("Not implemented")}execute(t){return this.mode==="async"?this[this.executeMethod](t):new jn(()=>this[this.executeMethod](t))}mapResult(t,e){switch(this.executeMethod){case"run":return this.mapRunResult(t,e);case"all":return this.mapAllResult(t,e);case"get":return this.mapGetResult(t,e)}}}a(Mn,Si,"PreparedQuery");var vi;vi=m;class En{constructor(t){this.dialect=t}prepareOneTimeQuery(t,e,s,i,n,o,l){return this.prepareQuery(t,e,s,i,n,o,l)}run(t){const e=this.dialect.sqlToQuery(t);try{return this.prepareOneTimeQuery(e,void 0,"run",!1).run()}catch(s){throw new je({cause:s,message:`Failed to run the query '${e.sql}'`})}}extractRawRunValueFromBatchResult(t){return t}all(t){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(t),void 0,"run",!1).all()}extractRawAllValueFromBatchResult(t){throw new Error("Not implemented")}get(t){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(t),void 0,"run",!1).get()}extractRawGetValueFromBatchResult(t){throw new Error("Not implemented")}values(t){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(t),void 0,"run",!1).values()}async count(t){return(await this.values(t))[0][0]}extractRawValuesValueFromBatchResult(t){throw new Error("Not implemented")}}a(En,vi,"SQLiteSession");var qi,Ti;class An extends(Ti=ft,qi=m,Ti){constructor(t,e,s,i,n=0){super(t,e,s,i),this.schema=i,this.nestedIndex=n}rollback(){throw new Qn}}a(An,qi,"SQLiteTransaction");var xi,$i;class Dn extends($i=En,xi=m,$i){constructor(e,s,i,n,o={}){super(s);a(this,"logger");a(this,"cache");this.client=e,this.schema=i,this.batchCLient=n,this.logger=o.logger??new Ii,this.cache=o.cache??new dt}prepareQuery(e,s,i,n,o,l,c){return new In(this.client,e,this.logger,this.cache,l,c,s,i,n,o)}async batch(e){const s=[],i=[];for(const o of e){const l=o._prepare(),c=l.getQuery();s.push(l),i.push({sql:c.sql,params:c.params,method:c.method})}return(await this.batchCLient(i)).map((o,l)=>s[l].mapResult(o,!0))}async transaction(e,s){const i=new it("async",this.dialect,this,this.schema);await this.run(u.raw(`begin${s!=null&&s.behavior?" "+s.behavior:""}`));try{const n=await e(i);return await this.run(u`commit`),n}catch(n){throw await this.run(u`rollback`),n}}extractRawAllValueFromBatchResult(e){return e.rows}extractRawGetValueFromBatchResult(e){return e.rows[0]}extractRawValuesValueFromBatchResult(e){return e.rows}}a(Dn,xi,"SQLiteRemoteSession");var Qi,Ni;const Oe=class Oe extends(Ni=An,Qi=m,Ni){async transaction(t){const e=`sp${this.nestedIndex}`,s=new Oe("async",this.dialect,this.session,this.schema,this.nestedIndex+1);await this.session.run(u.raw(`savepoint ${e}`));try{const i=await t(s);return await this.session.run(u.raw(`release savepoint ${e}`)),i}catch(i){throw await this.session.run(u.raw(`rollback to savepoint ${e}`)),i}}};a(Oe,Qi,"SQLiteProxyTransaction");let it=Oe;var Ci,Li;class In extends(Li=Mn,Ci=m,Li){constructor(e,s,i,n,o,l,c,f,h,b){super("async",f,s,n,o,l);a(this,"method");this.client=e,this.logger=i,this.fields=c,this._isResponseInArrayMode=h,this.customResultMapper=b,this.customResultMapper=b,this.method=f}getQuery(){return{...this.query,method:this.method}}async run(e){const s=ye(this.query.params,e??{});return this.logger.logQuery(this.query.sql,s),await this.queryWithCache(this.query.sql,s,async()=>await this.client(this.query.sql,s,"run"))}mapAllResult(e,s){return s&&(e=e.rows),!this.fields&&!this.customResultMapper?e:this.customResultMapper?this.customResultMapper(e):e.map(i=>Tt(this.fields,i,this.joinsNotNullableMap))}async all(e){const{query:s,logger:i,client:n}=this,o=ye(s.params,e??{});i.logQuery(s.sql,o);const{rows:l}=await this.queryWithCache(s.sql,o,async()=>await n(s.sql,o,"all"));return this.mapAllResult(l)}async get(e){const{query:s,logger:i,client:n}=this,o=ye(s.params,e??{});i.logQuery(s.sql,o);const l=await this.queryWithCache(s.sql,o,async()=>await n(s.sql,o,"get"));return this.mapGetResult(l.rows)}mapGetResult(e,s){s&&(e=e.rows);const i=e;if(!this.fields&&!this.customResultMapper)return i;if(i)return this.customResultMapper?this.customResultMapper([e]):Tt(this.fields,i,this.joinsNotNullableMap)}async values(e){const s=ye(this.query.params,e??{});return this.logger.logQuery(this.query.sql,s),(await this.queryWithCache(this.query.sql,s,async()=>await this.client(this.query.sql,s,"values"))).rows}isResponseInArrayMode(){return this._isResponseInArrayMode}}a(In,Ci,"SQLiteProxyPreparedQuery");var Oi,_i;class Rn extends(_i=ft,Oi=m,_i){async batch(t){return this.session.batch(t)}}a(Rn,Oi,"SqliteRemoteDatabase");function co(r,t,e){const s=new Cn({casing:e==null?void 0:e.casing});let i,n,o,l={};t&&(typeof t=="function"?(o=t,l={}):(o=void 0,l=t),l.logger===!0?i=new Di:l.logger!==!1&&(i=l.logger,n=l.cache));let c;if(l.schema){const b=Ea(l.schema,Ra);c={fullSchema:l.schema,schema:b.tables,tableNamesMap:b.tableNamesMap}}const f=new Dn(r,s,c,o,{logger:i,cache:n}),h=new Rn("async",s,f,c);return h.$cache=n,h.$cache&&(h.$cache.invalidate=n==null?void 0:n.onMutate),h}export{no as S,fn as a,za as b,qa as c,co as d,m as e,ao as f,Ji as g,Pa as h,oo as i,Ye as j,ma as o,lo as s,Ua as t};
